/*! 2014 Baidu Inc. All Rights Reserved */
define("log",["require","./lib"],function(require){var t=require("./lib"),e=function(t){try{return new Function("return ("+t+")")()}catch(e){return{}}},i=function(){var e=[];return function(i){var n=e.push(document.createElement("img"))-1;e[n].onload=e[n].onerror=function(){e[n]=e[n].onload=e[n].onerror=null,delete e[n]};var s=r.action+t.toQueryString(i);e[n].src=s+"&"+(+new Date).toString(36),exports.fire("send",{url:s})}}(),n=function(i,n,r){var o,l,h=0,c=n,u=[],f=c.getAttribute("data-rsv");if(f)i.rsv=t.extend(i,{rsv:e(f)});for(var d,p=0,m=/\bOP_LOG_(TITLE|LINK|IMG|BTN|INPUT|OTHERS)\b/i;c!==r;){if("1"===c.getAttribute("data-nolog")){h=1;break}if(d=c.getAttribute("data-click"))i=t.extend(e(d),i);if(f=c.getAttribute("data-rsv"))i.rsv=t.extend(e(f),i.rsv);if(c.href)l=c.href,o="link";if("link"===o&&"H3"===c.tagName)o="title";if(m.test(c.className))o=RegExp.$1.toLowerCase();var g=1;if(c.previousSibling){var v=c.previousSibling;do{if(1===v.nodeType&&v.tagName===c.tagName)g++;v=v.previousSibling}while(v)}u[p++]=c.tagName+(g>1?g:""),c=c.parentNode}if(n!==r)if(d=r.getAttribute("data-click"))i=t.extend(e(d),i);if(h)return!h;u.reverse();var b=n.tagName.toLowerCase();if(!o&&/^(a|img|input|button|select|datalist|textarea)$/.test(b))o={a:"link"}[b]||"input",l=n.href||n.src||l;if(o=n.getAttribute("data-type")||o,!o)return!1;if(l)i.url=l;return a(i,n,"p1"),a(i,n,"act"),a(i,n,"item"),a(i,n,"mod",r.id),s(i,n,o,b,u,p),i.xpath=u.join("-").toLowerCase()+"("+o+")",i},s=function(e,i,n,s,a,r){var o="",l=function(t){return t.getAttribute("data-title")||t.title||t.textContent||t.innerText||""};if("input"===n)if(/input|textarea/.test(s)){if(o=i.value,i.type&&"password"===i.type.toLowerCase())o=""}else if(/select|datalist/.test(s)){if(i.children.length>0){var h=i.selectedIndex||0;o=i.children[h>-1?h:0].innerHTML}}else o=l(i)||i.value||"";else if(o=l(i),!o)for(var c=i,u=r;u>0;)if(u--,/^a\d*\b/i.test(a[u])){e.url=c.href,o=l(c);break}else{if(c.className&&/\bOP_LOG_[A-Z]+\b/.test(c.className)){o=l(c);break}c=c.parentNode}e.txt=t.trim(o).replace(/<[^>]+?>/g,"")},a=function(t,e,i,n){t[i]=e.getAttribute("data-"+i)||t[i]||n||"-"},r={action:"http://nsclick.baidu.com/v.gif?",main:"result-op",title:"OP_LOG_TITLE",link:"OP_LOG_LINK",img:"OP_LOG_IMG",btn:"OP_LOG_BTN",input:"OP_LOG_INPUT",others:"OP_LOG_OTHERS",data:{url:(window.location||document.location||{href:"-"}).href,pid:"-",cat:"-",page:"-",fr:"-",pvid:"-",rqid:"-",qid:"-",psid:"-",sid:"-",pn:"-",act:"-",mod:"-",item:"-",p1:"-",xpath:"-",f:"-",txt:"-",q:"-",rsv:null}},o=function(i,n){var s=e(i.getAttribute("data-click"));s.p1=n,i.setAttribute("data-click",t.stringify(s))},l=function(s,a){var l=a||t.getTarget(s),h=r.main,c=t.hasClass(l,h)?l:t.getAncestorByClass(l,h);if(c&&"1"!==c.getAttribute("data-nolog")){var u=l.getAttribute("data-click");if(u)u=e(u);if(u=n(u||{},l,c)){if(r.data)u=t.extend(t.extend({},r.data),u);if(!("p1"in u))t.each(t.q(r.main),function(t,e){if(t===c)u.p1=e+1;o(t,e+1)});exports.fire("click",{data:u,target:l,main:c}),i(u)}}},exports={config:function(e){return t.extend(r,e),this},start:function(){return t.on(document,"mousedown",l),this.fire("start"),this},stop:function(){return t.un(document,"mousedown",l),this},click:function(t){return l(null,t),this},fill:function(i,n){for(var s,a,r=0;s=i[r++];){if(a=s.getAttribute("data-click"))n=t.extend(e(a),n);s.setAttribute("data-click",t.stringify(n))}return this},live:function(e){var i=this.map;if(!i)i=this.map={},this.on("click",function(t){var e=t.data.mod;if(e&&e in i)i[e](t)});return t.extend(i,e),this},send:function(e){return i(t.extend(t.clone(r.data),e)),this}};return t.extend(exports,t.clone(t.observable)),exports});