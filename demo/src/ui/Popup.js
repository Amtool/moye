/*! 2014 Baidu Inc. All Rights Reserved */
define("Popup",["require","./lib","./Control"],function(require){var t=require("./lib"),e=require("./Control"),i=t.dom,n=t.page,s={onResize:function(){clearTimeout(this._resizeTimer);var t=this;this._resizeTimer=setTimeout(function(){t.show()},100)},onShow:function(e){var i=this.target;if(!this._disabled){if(i!==this.target)this.hide();var n=t.getTarget(e),s=this.liveTriggers;if(s){for(var a=this.options.triggers,r=t.hasClass;!r(n,a)&&n!==s;)n=n.parentNode;if(!r(n,a))return}this.fire("beforeShow",{event:e}),this.show(),this.trigger=n;var o=this._bound;this._timer=setTimeout(function(){t.on(document,"click",o.onHide),t.on(window,"resize",o.onResize)},0)}},onHide:function(e){var n=t.getTarget(e),s=this.main;if(s&&s!==n&&!i.contains(s,n))this.hide(),clearTimeout(this._resizeTimer)},computePosition:function(){var t=this.options,e=this.target||this.triggers[0],s=this.main,a=t.dir,r=i.getPosition(e),o=r.top,l=r.left,h=e.offsetWidth,c=e.offsetHeight,f=l+h,u=o+c,d=l+h/2,p=o+c/2,g=s.offsetWidth,m=s.offsetHeight,v=n.getScrollTop(),b=n.getScrollLeft(),y=b+n.getViewWidth(),C=v+n.getViewHeight(),w=e.getAttribute("data-popup");if(w)a=/[trbl]{2}/.test(w)?w:"1";var x,k;if("auto"===a){var M=h>g||l-(g-h)/2>0&&y>=f+(g-h)/2?"c":l+g>y?"r":"l",T=c>m||o-(m-c)/2>0&&C>=u+(m-c)/2?"c":o+m>C?"b":"t";if(C>=u+m)k="b",x=M;else if(y>=f+g)k="r",x=T;else if(o-m>=v)k="t",x=M;else if(l-g>=b)k="l",x=T;a=k+x}else k=a.charAt(0),x=a.charAt(1);var D=t.offset;if({t:1,b:1}[k])l={l:l,c:d-g/2,r:f-g}[x],o={t:o-m,b:u}[k];else if({l:1,r:1}[k])o={t:o,c:p-m/2,b:u-m}[x],l={l:l-g-D.x,r:f+D.x}[k];i.setStyles(s,{left:l+D.x+"px",top:o+D.y+"px"})}},a=e.extend({type:"Popup",options:{disabled:!1,main:"",target:"",triggers:"",liveTriggers:"",content:"",dir:"bl",prefix:"ecl-hotel-ui-popup",offset:{x:0,y:0}},init:function(e){if(this._disabled=e.disabled,this.content=e.content,this.bindEvents(s),e.target)this.target=t.g(e.target);var i=e.prefix,n=this.main=e.main&&t.g(e.main)||document.createElement("div");if(e.main)t.addClass(n,i);else n.className=i,n.style.left="-2000px";var a=e.triggers,r=e.liveTriggers,o=this._bound;if(r)this.liveTriggers=t.on(t.g(r),"click",o.onShow);else{if(t.isString(a))a=t.q(e.triggers);t.each(t.toArray(a),function(e){t.on(e,"click",o.onShow)}),this.triggers=a}},render:function(){var e=this.main;if(this.content)e.innerHTML=this.content;if(!this.rendered){this.rendered=!0,document.body.appendChild(e);var i=this;t.on(e,"click",function(t){i.fire("click",{event:t})})}return this},show:function(){s.computePosition.call(this),this.fire("show")},hide:function(){this.main.style.left="-2000px",this.fire("hide");var e=this._bound;t.un(document,"click",e.onHide),t.un(window,"resize",e.onResize),clearTimeout(this._timer),clearTimeout(this._resizeTimer)}});return a});