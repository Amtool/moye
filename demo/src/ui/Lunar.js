/*! 2014 Baidu Inc. All Rights Reserved */
define("Lunar",["require","jquery","./lib","./Control"],function(require){function t(t){var i=348+(g[t-1900]>>4).toString(2).replace(/0/g,"").length;return i+e(t)}function e(t){return i(t)?15===(15&g[t-1899])?30:29:0}function i(t){var e=15&g[t-1900];return 15===e?0:e}function n(t,e){return g[t-1900]&65536>>e?30:29}function s(t,e){var i=new Date(31556925974.7*(t-1900)+6e4*y[e]+Date.UTC(1900,0,6,2,5));return i.getUTCDate()+(b[t+""+e]||0)}function a(t){var e=t.getFullYear(),i=t.getMonth(),n=t.getDate(),a=n===s(e,2*i)?v[2*i]:n===s(e,2*i+1)?v[2*i+1]:"";return a?{type:"solar-term",text:a}:null}function r(t){if(11===t.month&&t.day>28){var e=new Date(t.solar.getTime()+864e5);if(e=u(e),1===e.day)t.month=0,t.day=0}var i=t.leap?"":w[d(t.month+1)+d(t.day)]||"";return i?{type:"lunar-festival",text:i}:null}function o(t){var e=C[d(t.getMonth()+1)+d(t.getDate())];return e?{type:"solar-festival",text:e}:null}function l(t){var e=t.getDay(),i=[d(t.getMonth()+1),e],n=t.getDate(),s=(7+e-(n-1))%7,a=new Date(t.getFullYear(),i[0],0),r=a.getDay(),o=a.getDate(),l=Math.ceil((n+s-1)/7)+(s>e?0:1),h=4+Math.floor((e+o-n)/7)+(e>r?0:1),u=x[i.join(l)]||x[i.join(h)];return u?{type:"solar-weak-festival",text:u}:null}function h(t,e){return r(e)||o(t)||l(t)||a(t)}function u(s){var a,r=0,o=0,l=(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())-Date.UTC(1900,0,31))/864e5;for(a=1900;2100>a&&l>0;a++)o=t(a),l-=o;if(0>l)l+=o,a--;var h=a;r=i(a);var u=!1;for(a=1;13>a&&l>0;a++){if(r>0&&a===r+1&&!u)--a,u=!0,o=e(h);else o=n(h,a);if(u&&a===r+1)u=!1;l-=o}if(0===l&&r>0&&a===r+1)if(u)u=!1;else u=!0,--a;if(0>l)l+=o,--a;return{year:h,month:a-1,day:l+1,leap:u,solar:s}}function f(t,e){var i,n=u(t),s=n.month,a=n.day,r=["初","十","廿","卅","卌"],o=["日","一","二","三","四","五","六","七","八","九","十"],l=["正","二","三","四","五","六","七","八","九","十","十一","腊"],f=h(t,n);if(!f){if(1===a)i=(n.leap?"闰":"")+l[s]+"月";else if(a%10>0)i=r[a/10|0]+o[a%10];else i=(a>10?o[a/10]:r[0])+o[10];f={type:"lunar",text:i}}return'<span class="'+e+"-"+f.type+'">'+f.text+"</span>"}function d(t){return(t>9?"":"0")+t}var c=require("jquery"),p=require("./lib"),m=require("./Control"),g=[19416,19168,42352,21717,53856,55632,21844,22191,39632,21970,19168,42422,42192,53840,53909,46415,54944,44450,38320,18807,18815,42160,46261,27216,27968,43860,11119,38256,21234,18800,25958,54432,59984,27285,23263,11104,34531,37615,51415,51551,54432,55462,46431,22176,42420,9695,37584,53938,43344,46423,27808,46416,21333,19887,42416,17779,21183,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,38310,38335,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,23232,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,20854,21183,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19195,19152,42192,53430,53855,54560,56645,46496,22224,21938,18864,42359,42160,43600,45653,27951,44448,19299,37759,18936,18800,25776,26790,59999,27424,42692,43759,37600,53987,51552,54615,54432,55888,23893,22176,42704,21972,21200,43448,43344,46240,46758,44368,21920,43940,42416,21168,45683,26928,29495,27296,44368,19285,19311,42352,21732,53856,59752,54560,55968,27302,22239,19168,43476,42192,53584,62034,54560],v=["小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"],y=[0,21208,42467,63836,85337,107014,128867,150921,173149,195551,218072,240693,263343,285989,308563,331033,353350,375494,397447,419210,440795,462224,483532,504758],b={19762:1,19802:1,20092:1,20129:-1,201222:1,20132:1,201313:-1,201323:1,20144:1,20150:1,201622:1,201713:-1,201723:-1,20183:1,20185:1,20192:-1,201911:-1,202012:-1,202015:-1,202022:1},w={"0100":"除夕","0101":"春节","0115":"元宵节","0202":"龙抬头","0505":"端午节","0707":"七夕","0715":"中元节","0815":"中秋节","0909":"重阳节",1208:"腊八节",1223:"小年"},C={"0101":"元旦","0214":"情人节","0308":"妇女节","0312":"植树节","0401":"愚人节","0422":"地球日","0501":"劳动节","0504":"青年节","0531":"无烟日","0601":"儿童节","0606":"爱眼日","0701":"建党日","0707":"抗战纪念日","0801":"建军节","0910":"教师节","0918":"九·一八纪念日",1001:"国庆节",1031:"万圣节",1111:"光棍节",1201:"艾滋病日",1213:"南京大屠杀纪念日",1224:"平安夜",1225:"圣诞节"},x={"0150":"国际麻风节","0520":"母亲节","0630":"父亲节",1144:"感恩节"},k="yyyy-MM-dd",M={},D={getYYYYMM:function(t){return p.isString(t)?t:this.format(this.from(t),"yyyyMM")},build:function(t){t=new Date((t||this.date).getTime()),this.monthElement.innerHTML=D.buildMonth.call(this,t),D.updateStatus.call(this),D.updatePrevNextStatus.call(this,t),this.fire("navigate",{date:t,yyyyMM:D.getYYYYMM.call(this,t)})},updatePrevNextStatus:function(t){var e=this.options,i=e.prefix,n=this.range,s=c(i+"-pre",this.main),a=c(i+"-next",this.main);t=t||this.date||this.from(this.value);var r=D.getYYYYMM.call(this,t);s[!n||!n.begin||D.getYYYYMM.call(this,n.begin)<r?"show":"hide"](),a[!n||!n.end||D.getYYYYMM.call(this,n.end)>r?"show":"hide"]()},buildMonth:function(t){var e=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),s=t.getDay(),a=e+d(i);if(M[a])return M[a];var r=7,o="-",l=this.options,h=l.prefix,u=[];u.push("<h3>"+e+"年"+i+"月</h3>");var c,p,m,g=l.first,v=this.days;for(u.push('<ul class="c-clearfix">'),c=0,p=v.length;p>c;c++)m=c===r-1||g&&c===r-2||!g&&c===g?' class="'+h+'-weekend"':"",u.push("<li"+m+">"+v[c]+"</li>");u.push("</ul>"),u.push('<p class="c-clearfix">');var y,b,w,C,x=0,k=(r+s+1-n%r)%r;if(p=k-g,p>0){for(t.setDate(0),y=t.getFullYear(),b=t.getMonth()+1,w=t.getDate(),C=[y,d(b),""].join(o),m=h+"-pre-month",c=w-p+1;w>=c;c++)x%=r,t.setDate(c),u.push('<a href="#" hidefocus class="'+m+'" data-date="'+C+d(c)+'" data-week="'+x+'">'+c+" "+f(t,h)+"</a>"),x++;t.setDate(w+1)}for(t.setDate(1),t.setMonth(i),t.setDate(0),C=[e,d(i),""].join(o),c=1,p=t.getDate();p>=c;c++)x%=r,t.setDate(c),u.push('<a href="#" hidefocus  data-date="'+C+d(c)+'" data-week="'+x+'">'+c+" "+f(t,h)+"</a>"),x++;for(t.setDate(p+1),y=t.getFullYear(),b=t.getMonth()+1,C=[y,d(b),""].join(o),m=h+"-next-month",p=(p+Math.max(0,k-g))%7,p=p>0?7-p:0,c=1;p>=c;c++)x%=r,t.setDate(c),u.push('<a href="#" hidefocus class="'+m+'" data-date="'+C+d(c)+'" data-week="'+x+'">'+c+" "+f(t,h)+"</a>"),x++;return u.push("</p>"),M[a]=u.join(""),M[a]},onClick:function(t){var e=t;if(e){for(var i=t.target,n=i.tagName;"A"!==n&&i!==this.main;)i=i.parentNode,n=i.tagName;var s=c(i);switch(n){case"A":t.preventDefault();var a=this.options.prefix,r=a+"-pre",o=a+"-next",l=a+"-go-today",h=a+"-add-event",u=a+"-disabled";if(s.hasClass(r))D.showPreMonth.call(this),t.stopPropagation();else if(s.hasClass(o))D.showNextMonth.call(this),t.stopPropagation();else if(s.hasClass(l)){var f=new Date;if(D.getYYYYMM.call(this,this.date)!==D.getYYYYMM.call(this,f))this.date=f,D.build.call(this)}else if(s.hasClass(h))this.fire("add",this);else if(!s.hasClass(u))D.pick.call(this,i,e)}this.fire("click",t)}},showPreMonth:function(){var t=this.date;t.setDate(0),D.build.call(this,t)},showNextMonth:function(){var t=this.date;t.setDate(1),t.setMonth(t.getMonth()+1),D.build.call(this,t)},updateStatus:function(){var t=this.options,e=t.prefix,i=t.process,n=t.first,s=new Date,a=this.format(s,k),r=this.range,o="",l="9999-12-31";if(r)o=r.begin&&this.format(r.begin,k)||o,l=r.end&&this.format(r.end,k)||l;var h,u,f,d,c,p,m,g,v,y=e+"-pre-month",b=e+"-next-month",w=e+"-disabled",C=e+"-today",x=e+"-weekend",M=this.main.getElementsByTagName("p");for(h=0,u=M.length;u>h;h++)for(c=M[h].getElementsByTagName("a"),f=0;d=c[f];f++){if(p=[],m=d.getAttribute("data-date"),g=d.className,v=!0,r&&(o>m||m>l))p.push(w),v=!1;var D=f%7;if(6===D||n&&5===D||!n&&0===D)p.push(x);if(~g.indexOf(y))p.push(y);else if(~g.indexOf(b))p.push(b);else if(m===a)p.push(C);if(i)i.call(this,d,p,m,v);d.className=p.join(" ")}},pick:function(t,e){var i=t.getAttribute("data-week"),n=this.from(t.getAttribute("data-date"),k),s=this.format(n);this.fire("pick",{value:s,week:this.options.lang.week+this.days[i],date:n,event:e})}},T=m.extend({type:"Lunar",options:{main:"",prefix:"ecl-ui-lunar",dateFormat:"",range:{begin:"1900-01-01",end:"2100-12-31"},value:"",process:null,first:0,lang:{week:"周",days:"日,一,二,三,四,五,六"}},init:function(t){this.bindEvents(D),this.dateFormat=t.dateFormat||T.DATE_FORMAT||k,this.days=t.lang.days.split(","),this.date=this.from(t.value),this.value=this.format(this.date),this.setRange(t.range||T.RANGE)},from:function(t,e){if(e=e||this.dateFormat,p.isString(t)){if(!t)return new Date;e=e.split(/[^yMdW]+/i),t=t.split(/\D+/);for(var i={},n=0,s=e.length;s>n;n++)if(e[n]&&t[n]&&(e[n].length>1&&t[n].length===e[n].length||1===e[n].length))i[e[n].toLowerCase()]=t[n];var a=i.yyyy||i.y||(i.yy<50?"20":"19")+i.yy,r=0|(i.m||i.mm),o=0|(i.d||i.dd);return new Date(0|a,r-1,o)}return t},format:function(t,e){if(e=(e||this.dateFormat).toLowerCase(),p.isString(t))t=this.from(t);var i=this.options,n=i.first,s=t.getFullYear(),a=t.getMonth()+1,r=t.getDate(),o=t.getDay();if(n)o=(o-1+7)%7;o=this.days[o];var l={yyyy:s,yy:s%100,y:s,mm:d(a),m:a,dd:d(r),d:r,w:o,ww:i.lang.week+o};return e.replace(/y+|M+|d+|W+/gi,function(t){return l[t]||""})},render:function(){var t=this.options;if(!this.rendered){this.rendered=!0;var e=this.main=p.g(t.main),i=t.prefix,n=i+"-month";e.innerHTML='<div class="'+n+'"></div><a href="#" class="'+i+'-pre"></a><a href="#" class="'+i+'-next"></a><a href="#" class="'+i+'-go-today">今天</a><a href="#" class="'+i+'-add-event">添加事件</a>',this.monthElement=c("."+n,e).get(0),D.build.call(this),c(e).on("click",this._bound.onClick).addClass("c-clearfix")}return this},getDayElements:function(){return this.monthElement.getElementsByTagName("a")},getDaysInfo:function(){var t=this.getDayElements(),e={};return c.each(t,function(t,i){var n=i.getAttribute("data-date");e[n]={date:n,element:i,week:0|i.getAttribute("data-week"),index:t,rows:t/7|0,cols:t%7}}),e},setRange:function(t){if(t){var e=t.begin,i=t.end;if(e&&p.isString(e))t.begin=this.from(e);if(i&&p.isString(i))t.end=this.from(i);this.range=t,this.rendered&&D.updatePrevNextStatus.call(this)}},setValue:function(t){this.date=this.from(t),this.value=this.format(this.date),D.build.call(this)}});return T.DATE_FORMAT=k,T});