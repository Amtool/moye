/*! 2014 Baidu Inc. All Rights Reserved */
define("Filter",["require","./lib","./Control"],function(require){var e=require("./lib"),t=require("./Control"),i={onClick:function(e){var t=this;t.fire("click",{event:e});var i=$(e.target),n=i,s=i.prop("tagName"),a=i.prop("type");if("LABEL"===s||"INPUT"===s){if("INPUT"===s){if("radio"===a)i.prop("checked",!1);i=i.parent()}else e.preventDefault(),n=i.find("input");var r=t.options,o=r.checkedClass,l=r.disabledClass,h="radio"===n.attr("type");if(!("LABEL"!==i.prop("tagName")||i.hasClass(l)||h&&n.prop("checked"))){var u=h?!0:!i.hasClass(o),d=$(t.groups[n.attr("name")]),c=d.find("."+o);if(h)c.removeClass(o);else{{t.options.allTag}if(i.attr("data-all")){if(i.hasClass("checked"))return void n.prop("checked",!0);c.removeClass(o).find("input").prop("checked",!1)}else d.find("label[data-all]").removeClass(o).find("input").prop("checked",!1)}n.prop("checked",u),i.toggleClass(o);var f=n.attr("name"),p=h?{key:f,value:[n.attr("value")]}:t.getData(f),m=p.value.join(","),g="data-value";if(d.attr(g)!==m)d.attr(g,m),t.fire("change",p)}}}},n=t.extend({type:"Filter",options:{disabled:!1,main:"",prefix:"ecl-ui-filter",allTag:"data-all",groups:"p",checkedClass:"checked",disabledClass:"disabled"},init:function(e){var t=this;t.disabled=e.disabled,t.main="string"==typeof e.main?$("#"+e.main):$(e.main),t.main=t.main[0],t.bindEvents(i)},render:function(e){var t=this,i="string"==typeof e?$("#"+e):$(e||t.main),n=t.options;if(!i.length)throw new Error("main not found!");if(!t.rendered){t.rendered=!0;var s=t.groups={};$(n.groups).each(function(e,t){s[$("input",t).attr("name")]=t}),i.on("click",t._bound.onClick)}return t},getData:function(e){var t=this,i=t.groups[e],n={key:e},s=n.value=[];if(!i)return n;var a=t.options.checkedClass,r=[],o=!1;if($("label",i).each(function(e,t){var i=$(t),n=i.find("input"),l=n.val();if(l&&r.push(l),i.hasClass(a))if(i.attr("data-all"))o=!0;else s.push(l)}),o)n.value=r;return n},disableItems:function(t,i){var n=this.options,s=n.checkedClass,a=n.disabledClass,r=this.groups[t],o=",";if(r)i=i.join(o),$("input",r).each(function(t,n){var r=$(n),l=r.parent();if(e.contains(i,r.attr("value"),o))r.prop("checked",!1),l.removeClass(s).addClass(a);else l.removeClass(a)})},enableItems:function(e){var t=this.options.disabledClass,i=this.groups[e];if(i)$("."+t,i).removeClass(t)}});return n});