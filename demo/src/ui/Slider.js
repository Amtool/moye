/*! 2014 Baidu Inc. All Rights Reserved */
define("Slider",["require","./lib","./Control","./SliderAnim"],function(require){function t(t){if(t.children)return t.children;for(var e=[],i=t.firstChild;i;i=i.nextSibling)if(1===i.nodeType)e.push(i);return e}var e=require("./lib"),i=require("./Control"),s=require("./SliderAnim"),n={clearSwitchTimer:function(){clearTimeout(this._switchTimer),this._switchTimer=0},onEnter:function(){if(this.options.auto)n.clearSwitchTimer.call(this)},onLeave:function(){if(this.options.auto)this.play()},onSwitch:function(){this.next(),this.play()},onPrevClick:function(){var t=this;if(!t._switchDelayTimer)t._switchDelayTimer=setTimeout(function(){n.clearSwitchDelayTimer.call(t),t.prev()},t.options.switchDelay)},onNextClick:function(){var t=this;if(!t._switchDelayTimer)t._switchDelayTimer=setTimeout(function(){n.clearSwitchDelayTimer.call(t),t.next()},t.options.switchDelay)},onIndexClick:function(t){var i=this,s=e.getTarget(t);if(""!==s["data-index"]&&!i._switchDelayTimer){var a=s.getAttribute("data-index");i._switchDelayTimer=setTimeout(function(){n.clearSwitchDelayTimer.call(i),i.go(+a)},i.options.switchDelay)}},clearSwitchDelayTimer:function(){clearTimeout(this._switchDelayTimer),this._switchDelayTimer=0},setCurrent:function(){var i=this.options;if(i.prevElement)e[0===this.index&&!i.circle?"addClass":"removeClass"](i.prevElement,this.getClass("prev-disable"));if(i.nextElement)e[this.index===this.count-1&&!i.circle?"addClass":"removeClass"](i.nextElement,this.getClass("next-disable"));if(i.indexElment){var s=t(i.indexElment);s[this.lastIndex]&&e.removeClass(s[this.lastIndex],this.getClass("index-selected")),s[this.index]&&e.addClass(s[this.index],this.getClass("index-selected"))}}},a=i.extend({getChildren:t,type:"Slider",options:{main:"",stage:"",prevElement:"",nextElement:"",indexElment:"",auto:!0,circle:!0,autoInterval:2e3,switchDelay:50,onChange:null,prefix:"ecl-ui-slider",anim:"slide",animOptions:{easing:"",interval:200,direction:"",rollCycle:""}},init:function(t){this._disabled=t.disabled,this.bindEvents(n);var i=this._bound;if(t.main){if(this.main=e.g(t.main),e.addClass(this.main,t.prefix),e.on(this.main,"mouseenter",i.onEnter),e.on(this.main,"mouseleave",i.onLeave),t.stage=e.g(t.stage)||e.q(this.getClass("stage"),this.main)[0],t.prevElement=e.g(t.prevElement)||this.query(this.getClass("prev"))[0],t.nextElement=e.g(t.nextElement)||this.query(this.getClass("next"))[0],t.indexElment=e.g(t.indexElment)||this.query(this.getClass("index"))[0],t.prevElement)e.on(t.prevElement,"click",i.onPrevClick);if(t.nextElement)e.on(t.nextElement,"click",i.onNextClick);if(t.indexElment)e.on(t.indexElment,"click",i.onIndexClick);var a="string"==typeof t.anim?s.anims[t.anim]:t.anim;this.curAnim=new a(this,t.animOptions)}},getClass:function(t){return t=t?"-"+t:"",this.options.prefix+t},getIndex:function(t){var e=this.index;if("start"===t)e=0;else if("end"===t)e=this.count-1;else e=+t||0;if(e===this.index)return-1;if(e>=this.count)e=this.options.circle?0:this.count-1;else if(0>e)e=this.options.circle?this.count-1:0;return e},play:function(){if(this.options.auto)n.clearSwitchTimer.call(this),this._switchTimer=setTimeout(this._bound.onSwitch,this.options.autoInterval)},refresh:function(){var i=this,s=this.options,a=t(s.stage);if(e.each(a,function(t){e.addClass(t,i.getClass("item"))}),s.indexElment)e.each(t(s.indexElment),function(t,e){t.setAttribute("data-index",e)});i.stage=s.stage,i.index=0,i.count=a.length,i.stageWidth=s.stage.clientWidth,i.stageHeight=s.stage.clientHeight,n.setCurrent.call(this),i.curAnim.refresh()},render:function(){return this.refresh(),this.play(),this},prev:function(){return this.go(this.index-1),this},next:function(){return this.go(this.index+1),this},go:function(t){var e=this.getIndex(t);if(-1!==e)if(!1!==this.curAnim.switchTo(e,this.index)){this.lastIndex=this.index,this.index=e,n.setCurrent.call(this);var i={index:e,lastIndex:this.lastIndex};this.fire("change",i)}},dispose:function(){n.clearSwitchDelayTimer.call(this),n.clearSwitchTimer.call(this),this.curAnim.dispose(),this.curAnim=null;var t=this._bound,i=this.options;if(i.prevElement)e.un(i.prevElement,"click",t.onPrevClick);if(i.nextElement)e.un(i.nextElement,"click",t.onNextClick);if(i.indexElment)e.un(i.indexElment,"click",t.onIndexClick);e.un(this.main,"mouseenter",t.onEnter),e.un(this.main,"mouseleave",t.onLeave),this.main=this.stage=this.options=null,this.parent("dispose")}});return a.Anim=s,a});