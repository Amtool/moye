/*! 2014 Baidu Inc. All Rights Reserved */
define("Dialog",["require","./lib","./Control"],function(require){function t(t){t&&t.parentNode.removeChild(t)}function e(t,e){t=String(t);var i=Array.prototype.slice.call(arguments,1),n=Object.prototype.toString;if(i.length)return i=1===i.length?null!==e&&/\[object (Array|Object)\]/.test(n.call(e))?e:i:i,t.replace(/#\{(.+?)\}/g,function(t,e){var s=i[e];if("[object Function]"===n.call(s))s=s(e);return"undefined"==typeof s?"":s});else return t}var i=require("./lib"),n=require("./Control"),s=i.newClass({initialize:function(t){var e=document.createElement("div");if(e.className=t.className,i.setStyles(e,t.styles),document.body.appendChild(e),this.mask=e,s.curMasks++,6===i.browser.ie&&!s.ie6frame)s.ie6frame=document.createElement('<iframe src="about:blank" frameborder="0" style="position:absolute;left:0;top:0;z-index:1;filter:alpha(opacity=0)"></iframe>'),document.body.appendChild(s.ie6frame)},repaint:function(){var t=Math.max(document.documentElement.clientWidth,Math.max(document.body.scrollWidth,document.documentElement.scrollWidth)),e=Math.max(document.documentElement.clientHeight,Math.max(document.body.scrollHeight,document.documentElement.scrollHeight));if(this.mask.style.width=t+"px",this.mask.style.height=e+"px",s.ie6frame)s.ie6frame.style.width=t+"px",s.ie6frame.style.height=e+"px"},show:function(){if(s.ie6frame)s.ie6frame.style.zIndex=this.mask.style.zIndex-1,i.show(s.ie6frame);i.show(this.mask)},hide:function(){if(s.ie6frame)i.hide(s.ie6frame);i.hide(this.mask)},dispose:function(){if(t(this.mask),s.curMasks--,s.curMasks<=0&&s.ie6frame)t(s.ie6frame),s.curMasks=0,s.ie6frame=null}});s.curMasks=0,s.create=function(t){return new s(t)};var a={getDom:function(t){return i.q(this.options.prefix+"-"+t,this.main)[0]},getClass:function(t){t=t?"-"+t:"";var e=this.options.skin;return this.options.prefix+t+(e?" "+e+t:"")},renderDOM:function(){var t=this.options,n={closeClass:a.getClass.call(this,"close"),headerClass:a.getClass.call(this,"header"),bodyClass:a.getClass.call(this,"body"),footerClass:a.getClass.call(this,"footer"),title:t.title,content:t.content,footer:t.footer},r=this.createElement("div",{className:a.getClass.call(this)});if(i.setStyles(r,{width:t.width,top:t.top,position:t.fixed?"fixed":"absolute",zIndex:t.level}),r.innerHTML=e(this.options.tpl,n),document.body.appendChild(r),this.main=r,this.options.showMask)this.mask=s.create({className:a.getClass.call(this,"mask"),styles:{zIndex:this.options.level-1}})},bind:function(){i.on(a.getDom.call(this,"close"),"click",this._bound.onClose)},getHeaderDom:function(){return a.getDom.call(this,"header")},getBodyDom:function(){return a.getDom.call(this,"body")},getFooterDom:function(){return a.getDom.call(this,"footer")},onClose:function(t){a.onHide.call(this,t)},onResize:function(){var t=this;clearTimeout(t._resizeTimer),t._resizeTimer=setTimeout(function(){t.adjustPos()},100)},onShow:function(t){var e=this;e.fire("beforeshow",{event:t}),e.show()},onHide:function(t){this.fire("beforehide",{event:t}),this.hide()}},r=n.extend({type:"Dialog",options:{main:"",prefix:"ecl-ui-dialog",title:"",content:"",footer:"",skin:"",width:"",top:"",left:"",fixed:1,showMask:1,level:10,dragable:1,tpl:'<div class="#{closeClass}">Ã—</div><div class="#{headerClass}">#{title}</div><div class="#{bodyClass}">#{content}</div><div class="#{footerClass}">#{footer}</div>'},init:function(t){this._disabled=t.disabled,this.bindEvents(a)},setTitle:function(t){a.getHeaderDom.call(this).innerHTML=t},setContent:function(t){a.getBodyDom.call(this).innerHTML=t},setFooter:function(t){a.getFooterDom.call(this).innerHTML=t},adjustPos:function(){var t=this.options.left,e=this.options.top;if(this.options.fixed){var n={left:t,top:e};if(!t)n.left="50%",n.marginLeft=-this.main.offsetWidth/2+"px";if(!e)n.top=.35*(i.getViewHeight()-this.main.offsetHeight)+"px";i.setStyles(this.main,n)}else{if(!t){var s=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft;t=s+(i.getViewWidth()-this.main.offsetWidth)/2+"px"}if(!e){var a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;e=a+.35*(i.getViewHeight()-this.main.offsetHeight)+"px"}i.setStyles(this.main,{position:"absolute",left:t,top:e})}this.mask&&this.mask.repaint()},show:function(){var t=this;return i.on(window,"resize",this._bound.onResize),t.mask&&t.mask.show(),i.each(a.getClass.call(this,"hide").split(" "),function(e){i.removeClass(t.main,e)}),t.adjustPos(),t.fire("show"),t},hide:function(){var t=this;return t.mask&&t.mask.hide(),i.each(a.getClass.call(this,"hide").split(" "),function(e){i.addClass(t.main,e)}),t.fire("hide"),i.un(window,"resize",this._bound.onResize),clearTimeout(t._resizeTimer),t},render:function(){var t=this.options;if(!this.rendered){if(t.fixed&&6===i.browser.ie)t.fixed=0;if(a.renderDOM.call(this),t.main){var e=i.g(t.main);e&&a.getBodyDom.call(this).appendChild(e)}a.bind.call(this),this.rendered=!0}return this},setWidth:function(t){var e=this;if(!e.rendered||1>t)return e;else return i.setStyles(e.main,{width:t+"px"}),e.adjustPos(),e},dispose:function(){this.fire("beforedispose");var t=this._bound;i.un(a.getDom.call(this,"close"),"click",t.onClose),i.un(window,"resize",t.onResize),clearTimeout(this._resizeTimer),this.mask&&this.mask.dispose(),this.parent("dispose")}});return r.Mask=s,r});