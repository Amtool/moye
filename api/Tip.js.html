<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Tip.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Tip.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Moye (Zhixin UI)
 * Copyright 2014 Baidu Inc. All rights reserved.
 *
 * @file  提示层控件
 * @author  chris(wfsr@foxmail.com)
 * @author  liulangyu(liulangyu90316@gmail.com)
 */

define(function (require) {

    var $       = require('jquery');
    var Control = require('./Control');
    var Popup   = require('./Popup');

    /**
     * 提示层控件
     *
     * @extends module:Popup
     * @requires lib
     * @requires Control
     * @requires Popup
     * @exports Tip
     * @example
     * new Tip({
     *     mode: 'over',
     *     arrow: "1",
     *     offset: {x: 5, y: 5},
     *     onBeforeShow: function () {
     *         this.title = Math.random();
     *     }
     * }).render();
     *
     */
    var Tip = Popup.extend(/** @lends module:Tip.prototype */{

        type: 'Tip',

        /**
         * 控件配置项
         *
         * @name module:Tip#options
         * @type {Object}
         * @property {boolean|string=} arrow 提示框的箭头参数，默认为false，不带箭头
         * 可以初始化时通过指定arrow属性为“1”开启箭头模式，也可以手动指定箭头方向：
         * tr | rt | rb | br | bl | lb | lt | tl | tc | rc | bc | lc
         * 也可通过在 triggers 上设置 data-tooltips来指定
         * @property {number=} showDelay 提示框显示的延迟时间，默认值为 100 毫秒
         * @property {number=} hideDelay 提示框消失的延迟时间，默认值为 300 毫秒
         * @property {string=} mode 提示的显示模式，over|click|static。默认为over
         * @property {string=} title 提示的标题信息，默认为null
         * @property {string} content 提示的内容信息
         * @property {string} prefix 控件class前缀，同时将作为main的class之一
         * @property {string} triggers 自动绑定本控件功能的class
         * @property {Object.&lt;string, number>} offset 浮层显示的偏移量
         * @property {number} offset.x x 轴方向偏移量
         * @property {number} offset.y y轴方向偏移量
         * @property {string} tpl 浮层内部HTML模板
         * @readonly
         */
        options: {
            /**
             * 弹出层所挂靠的目标
             *
             * 如果不指定, 那么会使用当前触发显示的目标来作为挂靠目标
             *
             * 请注意, 对target的交互并不会触发Popup的显示
             *
             * 触发显示的元素设定请参看triggers和liveTriggers
             *
             * @type {(string|HTMLElement)}
             */
            target: '',

            /**
             * 触发显示弹出层的节点(TODO 接口变化)
             *
             * 可以设定为string(className), 也可以设定为
             *
             * 当指定了 liveTriggers 时只能用 string 类型指定 class
             *
             * @type {(string | Array.&lt;HTMLElement>)}
             */
            triggers: '.tooltips',

            /**
             * 动态 triggers 的父元素节点
             *
             * @type {(string | HTMLElement)}
             */
            liveTriggers: '',

            // 提示框的箭头参数，默认为false，不带箭头
            // 可以初始化时通过指定arrow属性为“1”开启箭头模式
            // 也可以手动指定箭头方向：
            // tr | rt | rb | br | bl | lb | lt | tl | tc | rc | bc | lc。
            // 也可通过在 triggers 上设置 data-tooltips来指定
            arrow: false,

            // 提示框显示的延迟时间，默认值为 100 毫秒
            showDelay: 100,

            // 提示框消失的延迟时间，默认值为 300 毫秒
            hideDelay: 300,

            /**
             * 弹出模式
             * 可选值: click | over | static
             *
             * click: 当trigger被点击时展现, 当点击到trigger之外的元素时隐藏;
             * over: 当trigger有鼠标经过时展现, 当有鼠标移出时隐藏;
             * static: 不需要指定trigger, 只有当调用`show`方法时展现;
             *
             * @type {string}
             */
            mode: 'over',

            // 提示的内容信息
            content: '',

            /**
             * 弹出层显示在 trigger 的相对位置
             *
             * 可选值：tr | rt | rb | br | bl | lb | lt | tl | tc | rc | bc | lc
             * 也可通过在 triggers 上设置 data-popup来指定
             *
             * @type {string}
             * @defaultvalue
             */
            dir: 'bl',

            /**
             * 浮层显示的偏移量
             *
             * @type {Object}
             */
            offset: {

                /**
                 * x 轴方向偏移量
                 *
                 * @type {(number | string)}
                 * @defaultvalue
                 */
                x: 0,

                /**
                 * y 轴方向偏移量
                 *
                 * @type {(number | string)}
                 * @defaultvalue
                 */
                y: 0
            }
        },

        /**
         * 控件初始化
         *
         * @param {Object} options 控件配置项
         * @see module:Tip#options
         * @private
         */
        init: function (options) {
            // 处理dir和arrow
            options.arrow &amp;&amp; (options.dir = options.arrow);

            this.$parent(options);
        },

        /**
         * 初始化tip dom
         *
         * @private
         * @override
         */
        initStructure: function () {
            var me = this;

            var helper = me.helper;
            // 拼DOM
            var html = ''
                + helper.getPartHTML('arrow', 'div', '&lt;em>&lt;/em>&lt;ins>&lt;/ins>')
                + helper.getPartHTML('body', 'div', me.body || '');

            // 给样式, 弄到DOM树上
            $(me.main)
                .css('left', '-2000px')
                .appendTo(document.body)
                .html(html);

            // 把部件绑定到自己身上
            me.elements = {
                arrow: helper.getPart('arrow'),
                body: helper.getPart('body')
            };
        },

        /**
         * 初始化事件绑定
         *
         * @private
         */
        initEvents: function () {
            this.$parent();
        },

        /**
         * 重绘
         *
         * @protected
         * @override
         */
        repaint: require('./painter').createRepaint(
            Control.prototype.repaint,
            {
                name: 'content',
                paint: function (conf, content) {
                    this.setContent(content);
                }
            },
            function (changes, changesIndex) {
                if (!this.helper.isInStage('RENDERED')) {
                    return this;
                }
                var liveTriggers = changesIndex.liveTriggers;
                var triggers = changesIndex.triggers;
                if (!liveTriggers &amp;&amp; !triggers) {
                    return this;
                }
                // 首先把所有的triggers的事件绑定都清空掉
                this.clearTriggersEvents(triggers.oldValue, liveTriggers.oldValue);
                // 然后再绑定一下新的设置
                this.bindTriggersEvents(triggers.newValue, liveTriggers.newValue);
            }
        ),

        /**
         * 设置提示层显示的内容
         *
         * @param {string} html 要提示的内容的HTML
         * @public
         */
        setContent: function (html) {
            this.content = html || '';
            $(this.elements.body).html(this.content);
        },

        /**
         * 刷新触发器
         *
         * 用于经常更新的内容，在更新内容后调用此方法会
         * 解除旧 DOM 节点的绑定，再重新查找绑定新节点
         *
         * @param {string} triggers 触发器的 class
         * @public
         */
        refresh: function (triggers) {
            this.clearTriggersEvents(this.triggers, this.liveTriggers);

            this.triggers = triggers;
            this.bindTriggersEvents(this.triggers, this.liveTriggers);
        },

        /**
         * 计算浮层及箭头显示位置
         *
         * @public
         * @param {Element} target 挂靠目标元素
         */
        locate: function (target) {
            this.$parent(target);

            // 定位箭头
            var main = $(this.main);
            var arrow = this.elements.arrow;
            if (this.arrow === false) {
                $(arrow).hide();
                return;
            }

            target           = $(target);
            var lrtb         = {l: 'left', r: 'right', t: 'top', b: 'bottom'};
            var offset       = this.offset;
            var offsetX      = offset.x;
            var offsetY      = offset.y;
            var position     = target.offset();

            var width        = target.outerWidth();
            var height       = target.outerHeight();
            var top          = position.top;
            var left         = position.left;
            var right        = left + width;
            var bottom       = top + height;

            var helper       = this.helper;

            var dir          = this._dir;
            var first        = dir.charAt(0);
            var second       = dir.charAt(1);

            // 提示层宽高
            var mainWidth    = main.outerWidth();
            var mainHeight   = main.outerHeight();

            arrow.className = ''
                + helper.getPartClassName('arrow')
                + ' '
                + helper.getPartClassName('arrow-' + lrtb[first]);

            var arrowWidth  = arrow.firstChild.offsetWidth;
            var arrowHeight = arrow.firstChild.offsetHeight;

            // 提示层在目标上部或下部显示时的定位处理
            if ({t: 1, b: 1}[first]) {
                var middleX = (width - arrowWidth) / 2;

                // 在目标宽于提示层或 dir 为 tc 或 bc 时，箭头相对提示层水平居中
                $(arrow).css({
                    left: {
                        c: (mainWidth - arrowWidth) / 2,
                        l: middleX - offsetX,
                        r: mainWidth - Math.max(arrowWidth, middleX) + offsetX
                    }[width > mainWidth ? 'c' : second] + 'px',
                    top: ''
                });

                // 修正main 的 top
                top = {
                    t: top - arrowHeight - mainHeight - offsetY,
                    b: bottom + arrowHeight + offsetY
                }[first];
                main.css('top', top + 'px');
            }

            // 提示层在目标左边或右边显示时的定位处理
            else if ({l: 1, r: 1}[first]) {
                var middleY = (height - arrowHeight) / 2;

                // 在目标高于提示层或 dir 为 lc 或 rc 时，箭头相对提示层垂直居中
                $(arrow).css({
                    top: {
                        c: (mainHeight - arrowHeight) / 2,
                        t: middleY - offsetY,
                        b: mainHeight - Math.max(arrowHeight, middleY) + offsetY
                    }[height > mainHeight ? 'c' : second] + 'px',
                    left: ''
                });

                // 修正main 的 left
                left = {
                    l: left - arrowWidth - mainWidth - offsetX,
                    r: right + arrowWidth + offsetX
                }[first];
                main.css('left', left + 'px');
            }
        }
    });

    return Tip;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BoxGroup.html">BoxGroup</a></li><li><a href="module-Button.html">Button</a></li><li><a href="module-ButtonCountdown.html">ButtonCountdown</a></li><li><a href="module-Calendar.html">Calendar</a></li><li><a href="module-City.html">City</a></li><li><a href="module-Context.html">Context</a></li><li><a href="module-Control.html">Control</a></li><li><a href="module-Cookie.html">Cookie</a></li><li><a href="module-Dialog.html">Dialog</a></li><li><a href="module-Form.html">Form</a></li><li><a href="module-FormFieldWatcher.html">FormFieldWatcher</a></li><li><a href="module-FormRelation.html">FormRelation</a></li><li><a href="module-FormSubmit.html">FormSubmit</a></li><li><a href="module-Helper.html">Helper</a></li><li><a href="module-Lazy.html">Lazy</a></li><li><a href="module-LazyImg.html">LazyImg</a></li><li><a href="module-Lazyload.html">Lazyload</a></li><li><a href="module-lib.html">lib</a></li><li><a href="module-log.html">log</a></li><li><a href="module-main.html">main</a></li><li><a href="module-Marquee.html">Marquee</a></li><li><a href="module-Mask.html">Mask</a></li><li><a href="module-Pager.html">Pager</a></li><li><a href="module-painter.html">painter</a></li><li><a href="module-Panel.html">Panel</a></li><li><a href="module-Plugin.html">Plugin</a></li><li><a href="module-Popup.html">Popup</a></li><li><a href="module-Rating.html">Rating</a></li><li><a href="module-ScrollBar.html">ScrollBar</a></li><li><a href="module-Select.html">Select</a></li><li><a href="module-Slider.html">Slider</a></li><li><a href="module-SliderAnim.html">SliderAnim</a></li><li><a href="module-Tab.html">Tab</a></li><li><a href="module-TabBar.html">TabBar</a></li><li><a href="module-Tag.html">Tag</a></li><li><a href="module-TextBox.html">TextBox</a></li><li><a href="module-TextBoxAutoComplete.html">TextBoxAutoComplete</a></li><li><a href="module-TextBoxPlaceHolder.html">TextBoxPlaceHolder</a></li><li><a href="module-Tip.html">Tip</a></li><li><a href="module-ValidateTip.html">ValidateTip</a></li><li><a href="module-Validator.html">Validator</a></li><li><a href="module-ValidityRule.html">ValidityRule</a></li></ul><h3>Classes</h3><ul><li><a href="Validity.html">Validity</a></li><li><a href="ValidityState.html">ValidityState</a></li></ul><h3>Events</h3><ul><li><a href="module-Calendar.html#event:hide">hide</a></li><li><a href="module-Calendar.html#event:pick">pick</a></li><li><a href="module-Calendar.html#event:show">show</a></li><li><a href="module-City.html#event:beforeShow">beforeShow</a></li><li><a href="module-City.html#event:pick">pick</a></li><li><a href="module-Control.html#event:afterdispose">afterdispose</a></li><li><a href="module-Control.html#event:afterrender">afterrender</a></li><li><a href="module-Control.html#event:beforedispose">beforedispose</a></li><li><a href="module-Control.html#event:beforerender">beforerender</a></li><li><a href="module-Control.html#event:disable">disable</a></li><li><a href="module-Control.html#event:enable">enable</a></li><li><a href="module-Control.html#event:statechange">statechange</a></li><li><a href="module-Dialog.html#event:dispose">dispose</a></li><li><a href="module-Dialog.html#event:hide">hide</a></li><li><a href="module-Form.html#event:submit">submit</a></li><li><a href="module-FormFieldWatcher.html#event:fieldchange%25E5%259F%259F%25E8%25BE%2593%25E5%2585%25A5%25E5%258F%2598%25E5%258C%2596%25E4%25BA%258B%25E4%25BB%25B6">fieldchange 域输入变化事件</a></li><li><a href="module-log.html#event:click">click</a></li><li><a href="module-log.html#event:send">send</a></li><li><a href="module-log.html#event:start">start</a></li><li><a href="module-Pager.html#event:change">change</a></li><li><a href="module-Popup.html#event:beforeshow">beforeshow</a></li><li><a href="module-Popup.html#event:click">click</a></li><li><a href="module-Popup.html#event:hide">hide</a></li><li><a href="module-Popup.html#event:show">show</a></li><li><a href="module-Rating.html#event:change">change</a></li><li><a href="module-Rating.html#event:hover">hover</a></li><li><a href="module-ScrollBar.html#event:change">change</a></li><li><a href="module-Select.html#event:change">change</a></li><li><a href="module-Slider.html#event:change">change</a></li><li><a href="module-Tab.html#event:change">change</a></li><li><a href="module-TextBox.html#event:autocomplete">autocomplete</a></li><li><a href="module-TextBox.html#event:autocompletebeforeshow">autocompletebeforeshow</a></li><li><a href="module-TextBox.html#event:autocompleteclick">autocompleteclick</a></li><li><a href="module-TextBox.html#event:autocompletehide">autocompletehide</a></li><li><a href="module-TextBox.html#event:autocompletepick">autocompletepick</a></li><li><a href="module-TextBox.html#event:autocompleteshow">autocompleteshow</a></li><li><a href="module-Validator.html#event:aftervalidate%25E6%25A0%25A1%25E9%25AA%258C%25E5%25AE%258C%25E6%2588%2590%25E4%25BA%258B%25E4%25BB%25B6">aftervalidate 校验完成事件</a></li><li><a href="module-Validator.html#event:beforevalidate">beforevalidate</a></li><li><a href="module-Validator.html#event:invalid%25E6%25A0%25A1%25E9%25AA%258C%25E4%25B8%258D%25E9%2580%259A%25E8%25BF%2587%25E4%25BA%258B%25E4%25BB%25B6">invalid 校验不通过事件</a></li><li><a href="module-Validator.html#event:valid%25E6%25A0%25A1%25E9%25AA%258C%25E9%2580%259A%25E8%25BF%2587%25E4%25BA%258B%25E4%25BB%25B6">valid 校验通过事件</a></li><li><a href="module-Validator.html#event:validating%25E6%25A0%25A1%25E9%25AA%258C%25E4%25B8%25AD%25E4%25BA%258B%25E4%25BB%25B6%25EF%25BC%258C%25E9%2592%2588%25E5%25AF%25B9%25E5%25BC%2582%25E6%25AD%25A5%25E6%25A0%25A1%25E9%25AA%258C%25E6%2589%258D%25E6%259C%2589">validating 校验中事件，针对异步校验才有</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-lib.browser.html">browser</a></li></ul><h3>Interfaces</h3><ul><li><a href="configurable.html">configurable</a></li><li><a href="observable.html">observable</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Tue Aug 11 2015 21:00:39 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
