<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Marquee.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Marquee.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Moye (Zhixin UI)
 * Copyright 2014 Baidu Inc. All rights reserved.
 *
 * @file  走马灯控件
 * @author  cxtom(cxtom2010@gmail.com)
 */

define(function (require) {

    var $ = require('jquery');
    var lib = require('./lib');
    var Control = require('./Control');


    /**
     * 方向 - css padding
     *
     * @const
     * @type {string}
     */
    var MAP_GAP = {
        left: 'padding-right',
        right: 'padding-left',
        up: 'padding-bottom',
        down: 'padding-top'
    };

    var behaviors = {

        /**
         * 内容长度大于容器长度，连续滚动（首尾相连的）
         */
        continous: function bContinus() {
            this.timeoutID = setTimeout($.proxy(bContinus, this), this.speed);
            var text = this.item;
            text.css(this.getDirection(), this.pos + 'px');
            this.pos--;

            if (this.pos &lt; -this.max) {
                // 马上在后面添加一个副本
                text.append(this.itemHtml);
                var eles = text.find('span');
                var len = eles.length;

                if (len &lt;= 2 &amp;&amp; !this.vertical) {
                    this.max = this.direction === 'left' ? (this.max + this.width) : this.max;
                    this.pos = this.direction === 'left' ? this.pos : (this.pos + this.width);
                    return;
                }
                else if (len &lt;= 2 &amp;&amp; this.vertical) {
                    this.max = this.direction === 'up' ? (this.max + this.height) : this.max;
                    this.pos = this.direction === 'up' ? this.pos : (this.pos + this.height);
                    return;
                }

                eles.eq(0).remove();
                this.pos += this.vertical ? this.height : this.width;
            }
        },

        /**
         * 循环滚动
         */
        scroll: function bScroll() {
            this.timeoutID = setTimeout($.proxy(bScroll, this), this.speed);
            var text = this.item;
            text.css(this.getDirection(), this.pos + 'px');
            this.pos--;

            if (this.pos &lt; -this.max) {
                this.initPosition();
            }

        }
    };

    /**
     * 获取不同滚动方式的限制值
     * @type {Object}
     */
    var initMax = {
        continous: function () {
            switch (this.direction) {
                case 'left':
                    this.max = this.width - this.main.width();
                    break;
                case 'down':
                case 'right':
                    this.max = 0;
                    break;
                case 'up':
                    this.max = this.height - this.main.height();
                    break;
            }
        },
        scroll: function () {
            switch (this.direction) {
                case 'left':
                    this.max = this.width;
                    break;
                case 'right':
                    this.max = this.main.outerWidth();
                    break;
                case 'up':
                    this.max = this.height;
                    break;
                case 'down':
                    this.max = this.main.outerHeight();
                    break;
            }
        }
    };

    function clear() {
        this.timeoutID &amp;&amp; clearTimeout(this.timeoutID);
        this.timeoutID = null;
    }

    /**
     * 走马灯控件
     *
     * @extends module:Control
     * @requires lib
     * @requires Control
     * @exports Marquee
     * @example
     * &amp;lt;div id="example" class="ui-marquee" /&amp;gt;
     * new Marquee({
     *     main: $('#example'),
     *     content: 'XXXXXXXXXX'
     *  }).render();
     */
    var Marquee = Control.extend(/** @lends module:Marquee.prototype */{

        /**
         * 控件类型标识
         *
         * @type {string}
         * @private
         */
        type: 'Marquee',


        /**
         * 控件配置项
         *
         * @name module:Marquee#options
         * @type {Object}
         * @property {number} speed 动画速度
         * @property {(string | HTMLElement)} main 控件渲染容器
         * @property {string} direction 滚动方向 可选值（默认为 left）：left | right | up | down
         * @property {string} content 提示的内容信息，可以是html
         * @property {boolean} hoverable 是否鼠标悬停
         * @property {boolean} auto 是否自动开始动画
         * @property {number} continus类型时，循环滚动的间距
         * @property {string} behavior 滚动方式 可选值（默认为 continous）: continous | scroll
         * @private
         */
        options: {

            /**
             * 动画速度
             *
             * @type {number}
             * @defaultvalue
             */
            speed: 16,

            /**
             * 动画方向
             * 可选值: left | right
             * TODO:  up | down
             *
             * @type {string}
             * @defaultvalue
             */
            direction: 'left',

            /**
             * 显示内容
             *
             * @type {string}
             * @defaultvalue
             */
            content: '',

            /**
             * 鼠标悬停停止
             *
             * @type {boolean}
             * @defaultvalue
             */
            hoverable: true,

            /**
             * 是否自动开始
             *
             * @type {boolean}
             * @defaultvalue
             */
            auto: true,

            /**
             * 循环滚动间距,单位px
             *
             * @type {number}
             * @defaultvalue
             */
            gap: 80,

            /**
             * 动画类型
             * 可选值: continous | scroll
             * TODO: alternate | slide
             *
             * @type {number}
             * @defaultvalue
             */
            behavior: 'continous'
        },

        /**
         * 控件初始化
         *
         * @param {Object} options 配置项
         * @see module:Marquee#options
         * @protected
         */
        init: function (options) {
            this.$parent(options);
            this.timeoutID = null;
            this.main = $(this.main);

            if ($.inArray(this.direction, ['left', 'right', 'up', 'down']) &lt; 0) {
                this.direction = 'left';
            }

            /**
             * 是否是垂直方向上的运动
             * @type {bool}
             */
            this.vertical = $.inArray(this.direction, ['up', 'down']) >= 0;

            if (this.vertical) {
                this.helper.addPartClasses('vertical');
            }

            this.helper.addPartClasses(this.behavior);
        },

        initStructure: function () {
            this.content = this.content || this.main.data('content') || '';

            this.itemHtml = '&lt;span style="' + this.getGapStr() + '">' + this.content + '&lt;/span>';
            this.main.html('&lt;span>' + this.itemHtml + '&lt;/span>');

            var span = this.main.children('span');
            this.item = span;
            this.width = this.width || span.outerWidth();
            this.height = this.height || span.outerHeight();
            this.initPosition();

            // 初始化位置
            this.item.css(this.getDirection(), this.pos);

            // continous特殊处理，内容长度小于容器长度，自动把滚动方式置为scroll
            if (this.behavior === 'continous'
                &amp;&amp; (!this.vertical &amp;&amp; this.width &lt; this.main.width()
                || this.vertical &amp;&amp; this.height &lt; this.main.height())
            ) {

                this.vertical ? this.height -= this.gap : this.width -= this.gap;

                this.behavior = 'scroll';
                this.helper.removePartClasses('continus');
                this.helper.addPartClasses('scroll');
                this.item.children('span').css('padding', '0');
            }

            initMax[this.behavior].call(this);

            this.start = $.proxy(behaviors[this.behavior], this);
            this.stop = $.proxy(clear, this);

            if (this.auto) {
                this.start();
                return;
            }
            this.timeoutID = null;
        },

        /**
         * 初始化事件绑定
         *
         * @protected
         */
        initEvents: function () {
            if (this.hoverable) {
                $(this.main).on('mouseenter', this.stop);
                $(this.main).on('mouseleave', this.start);
            }
        },

        /**
         * 根据direction，返回position对应的属性
         *
         * @return {string}
         * @protected
         */
        getDirection: function () {
            var MAP_DIRECTION = {
                up: 'top',
                down: 'bottom'
            };

            return MAP_DIRECTION[this.direction] || this.direction;
        },

        /**
         * 根据direction，返回设置间距的css字符串
         *
         * @return {string}
         * @protected
         */
        getGapStr: function () {

            if (this.behavior !== 'continous') {
                return '';
            }

            return MAP_GAP[this.direction] + ':' + this.gap + 'px';
        },


        /**
         * 设置初始位置
         *
         * @protected
         */
        initPosition: function () {
            switch (this.direction) {
                case 'right':
                    this.pos = this.width;
                    break;
                case 'up':
                    this.pos = this.main.outerHeight();
                    break;
                case 'down':
                    this.pos = this.height;
                    break;
                case 'left':
                    this.pos = this.main.outerWidth();
                    break;
            }
        },

        /**
         * 销毁Marquee控件
         *
         * @public
         */
        dispose: function () {

            this.stop();

            if (this.hoverable) {
                $(this.main).off('mouseenter', this.stop);
                $(this.main).off('mouseleave', this.start);
            }
            this.item = null;
            this.itemHtml = '';
            this.start = $.noop;
            this.stop = $.noop;
            $(this.main).html('');
            this.$parent();
        }

    }).implement(lib.observable).implement(lib.configurable);

    return Marquee;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BoxGroup.html">BoxGroup</a></li><li><a href="module-Button.html">Button</a></li><li><a href="module-ButtonCountdown.html">ButtonCountdown</a></li><li><a href="module-Calendar.html">Calendar</a></li><li><a href="module-City.html">City</a></li><li><a href="module-Context.html">Context</a></li><li><a href="module-Control.html">Control</a></li><li><a href="module-Cookie.html">Cookie</a></li><li><a href="module-Dialog.html">Dialog</a></li><li><a href="module-Form.html">Form</a></li><li><a href="module-FormFieldWatcher.html">FormFieldWatcher</a></li><li><a href="module-FormRelation.html">FormRelation</a></li><li><a href="module-FormSubmit.html">FormSubmit</a></li><li><a href="module-Helper.html">Helper</a></li><li><a href="module-Lazy.html">Lazy</a></li><li><a href="module-LazyImg.html">LazyImg</a></li><li><a href="module-Lazyload.html">Lazyload</a></li><li><a href="module-lib.html">lib</a></li><li><a href="module-log.html">log</a></li><li><a href="module-main.html">main</a></li><li><a href="module-Marquee.html">Marquee</a></li><li><a href="module-Mask.html">Mask</a></li><li><a href="module-Pager.html">Pager</a></li><li><a href="module-painter.html">painter</a></li><li><a href="module-Panel.html">Panel</a></li><li><a href="module-Plugin.html">Plugin</a></li><li><a href="module-Popup.html">Popup</a></li><li><a href="module-Rating.html">Rating</a></li><li><a href="module-ScrollBar.html">ScrollBar</a></li><li><a href="module-Select.html">Select</a></li><li><a href="module-Slider.html">Slider</a></li><li><a href="module-SliderAnim.html">SliderAnim</a></li><li><a href="module-Tab.html">Tab</a></li><li><a href="module-TabBar.html">TabBar</a></li><li><a href="module-Tag.html">Tag</a></li><li><a href="module-TextBox.html">TextBox</a></li><li><a href="module-TextBoxAutoComplete.html">TextBoxAutoComplete</a></li><li><a href="module-TextBoxPlaceHolder.html">TextBoxPlaceHolder</a></li><li><a href="module-Tip.html">Tip</a></li><li><a href="module-ValidateTip.html">ValidateTip</a></li><li><a href="module-Validator.html">Validator</a></li><li><a href="module-ValidityRule.html">ValidityRule</a></li></ul><h3>Classes</h3><ul><li><a href="Validity.html">Validity</a></li><li><a href="ValidityState.html">ValidityState</a></li></ul><h3>Events</h3><ul><li><a href="module-Calendar.html#event:hide">hide</a></li><li><a href="module-Calendar.html#event:pick">pick</a></li><li><a href="module-Calendar.html#event:show">show</a></li><li><a href="module-City.html#event:beforeShow">beforeShow</a></li><li><a href="module-City.html#event:pick">pick</a></li><li><a href="module-Control.html#event:afterdispose">afterdispose</a></li><li><a href="module-Control.html#event:afterrender">afterrender</a></li><li><a href="module-Control.html#event:beforedispose">beforedispose</a></li><li><a href="module-Control.html#event:beforerender">beforerender</a></li><li><a href="module-Control.html#event:disable">disable</a></li><li><a href="module-Control.html#event:enable">enable</a></li><li><a href="module-Control.html#event:statechange">statechange</a></li><li><a href="module-Dialog.html#event:dispose">dispose</a></li><li><a href="module-Dialog.html#event:hide">hide</a></li><li><a href="module-Form.html#event:submit">submit</a></li><li><a href="module-FormFieldWatcher.html#event:fieldchange%25E5%259F%259F%25E8%25BE%2593%25E5%2585%25A5%25E5%258F%2598%25E5%258C%2596%25E4%25BA%258B%25E4%25BB%25B6">fieldchange 域输入变化事件</a></li><li><a href="module-log.html#event:click">click</a></li><li><a href="module-log.html#event:send">send</a></li><li><a href="module-log.html#event:start">start</a></li><li><a href="module-Pager.html#event:change">change</a></li><li><a href="module-Popup.html#event:beforeshow">beforeshow</a></li><li><a href="module-Popup.html#event:click">click</a></li><li><a href="module-Popup.html#event:hide">hide</a></li><li><a href="module-Popup.html#event:show">show</a></li><li><a href="module-Rating.html#event:change">change</a></li><li><a href="module-Rating.html#event:hover">hover</a></li><li><a href="module-ScrollBar.html#event:change">change</a></li><li><a href="module-Select.html#event:change">change</a></li><li><a href="module-Slider.html#event:change">change</a></li><li><a href="module-Tab.html#event:change">change</a></li><li><a href="module-TextBox.html#event:autocomplete">autocomplete</a></li><li><a href="module-TextBox.html#event:autocompletebeforeshow">autocompletebeforeshow</a></li><li><a href="module-TextBox.html#event:autocompleteclick">autocompleteclick</a></li><li><a href="module-TextBox.html#event:autocompletehide">autocompletehide</a></li><li><a href="module-TextBox.html#event:autocompletepick">autocompletepick</a></li><li><a href="module-TextBox.html#event:autocompleteshow">autocompleteshow</a></li><li><a href="module-Validator.html#event:aftervalidate%25E6%25A0%25A1%25E9%25AA%258C%25E5%25AE%258C%25E6%2588%2590%25E4%25BA%258B%25E4%25BB%25B6">aftervalidate 校验完成事件</a></li><li><a href="module-Validator.html#event:beforevalidate">beforevalidate</a></li><li><a href="module-Validator.html#event:invalid%25E6%25A0%25A1%25E9%25AA%258C%25E4%25B8%258D%25E9%2580%259A%25E8%25BF%2587%25E4%25BA%258B%25E4%25BB%25B6">invalid 校验不通过事件</a></li><li><a href="module-Validator.html#event:valid%25E6%25A0%25A1%25E9%25AA%258C%25E9%2580%259A%25E8%25BF%2587%25E4%25BA%258B%25E4%25BB%25B6">valid 校验通过事件</a></li><li><a href="module-Validator.html#event:validating%25E6%25A0%25A1%25E9%25AA%258C%25E4%25B8%25AD%25E4%25BA%258B%25E4%25BB%25B6%25EF%25BC%258C%25E9%2592%2588%25E5%25AF%25B9%25E5%25BC%2582%25E6%25AD%25A5%25E6%25A0%25A1%25E9%25AA%258C%25E6%2589%258D%25E6%259C%2589">validating 校验中事件，针对异步校验才有</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-lib.browser.html">browser</a></li></ul><h3>Interfaces</h3><ul><li><a href="configurable.html">configurable</a></li><li><a href="observable.html">observable</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Tue Aug 11 2015 20:42:47 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
