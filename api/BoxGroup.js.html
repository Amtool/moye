<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: BoxGroup.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: BoxGroup.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Moye (Zhixin UI)
 * Copyright 2015 Baidu Inc. All rights reserved.
 *
 * @file 单复选框组件
 * @author dengxiaohong01(dengxiaohong01@baidu.com)
 */

define(
    function (require) {

        var $ = require('jquery');
        var Control = require('./Control');
        var painter = require('./painter');

        /**
         * 默认选中时的主题对应的样式
         *
         * @const
         * @type {Array}
         */
        var THEMEICON = {
            'default': {
                normal: '',
                expanded: ''
            },
            'radio-point': {
                normal: '&amp;#xe60b;',
                expanded: '&amp;#xe60a;'
            },
            'checkbox-tick': {
                normal: '&amp;#xe60c;',
                expanded: '&amp;#xe60d;'
            }
        };

        /**
         * 单复选框组件
         *
         * @extends module:Control
         * @requires Control
         * @requires painter
         * @exports BoxGroup
         * @example
         * &lt;div class="content">复选框1：&lt;div id="checkbox1">&lt;/div>&lt;/div>
         * new BoxGroup({
         *     main: document.getElementById('checkbox1'),
         *     styleClass: 'checkbox-tick',
         *     datasource: [
         *         {value: 0, name: '不限'},
         *         {value: 1, name: '中关村-上地'},
         *         {value: 2, name: '亚运村'},
         *         {value: 3, name: '北京南站商圈超长'}
         *      ],
         *      value: [1, 2]
         * }).render();
         */
        var BoxGroup = Control.extend(/** @lends module:BoxGroup.prototype */{

            /**
             * 控件类型标识
             *
             * @type {string}
             * @readonly
             * @public
             */
            type: 'BoxGroup',

            /**
             * 控件默认选项配置
             *
             * @name module:BoxGroup#options
             * @type {Object}
             *
             * @property {Object} options 控件选项配置
             * @property {(string | HTMLElement)} options.main 控件渲染容器
             * @property {string} options.boxType 选框类型：单选还是复选，默认复选(checkbox|radio)
             * @property {string} options.activeClass 元素选中样式的class
             * @property {string} options.styleClass 选框基本样式的class：默认有几种可供选择(default|radio-point|checkbox-tick)
             * @property {Array} options.datasource 展示的数据源
             * @property {Array} options.value 默认选中的元素：单选时取第一个
             * @public
             */
            options: {

                // 控件渲染主容器
                main: '',

                // 是单选还是复选，默认复选(checkbox| radio)
                boxType: 'checkbox',

                // 被选中时的样式
                activeClass: 'checked',

                //  单复选是哪种样式(default |radio-point |checkbox-tick)
                styleClass: 'default',

                // 数据源
                datasource: [],

                // 选中的元素 Array, 单选时取第一个
                value: []

            },

            /**
             * 控件初始化
             *
             * @param {Object} options 控件配置项
             * @see module:Boxgroup#options
             * @override
             */
            init: function (options) {
                this.$parent(options);
            },

            /**
             * 初始化BoxGroup事件绑定
             *
             * @override
             */
            initEvents: function () {
                this.delegate(this.main, 'click', 'label', this.onClick);
            },

            /**
             * 重绘BoxGroup控件
             *
             * @override
             */
            repaint: painter.createRepaint(
                Control.prototype.repaint,
                {
                    name: 'datasource',
                    paint: function (conf, datasource) {
                        var main = $(this.main);
                        if (this.helper.isInStage('INITED') &amp;&amp; main.data('dom-inited')) {
                            return;
                        }
                        datasource = this.datasource = datasource || [];
                        var html = [];
                        for (var i = 0, len = datasource.length; i &lt; len; i++) {
                            var item = datasource[i];
                            var state = $.inArray(item.value, this.value) > -1;
                            html[i] = this.getItemHTML(state, item);
                        }

                        main.html(html.join(''));
                        return this;
                    }
                },
                {
                    name: 'value',
                    paint: function (conf, value) {
                        var main = $(this.main);
                        if (this.helper.isInStage('INITED') &amp;&amp; main.data('dom-inited')) {
                            return;
                        }
                        value = this.value = value || [];
                        if (this.boxType.toLowerCase() === 'radio') {
                            value.length = 1;
                        }
                        $('label', main).each(function () {
                            var me = $(this);
                            var input = me.find('input');
                            var inputValue = +input.prop('value');
                            var bool = $.inArray(inputValue, value) > -1;
                            var act = bool ? 'addClass' : 'removeClass';

                            // 操作元素添加或移除activeClass 并指定checked属性的值
                            me[act](this.activeClass);
                            input.prop(
                                'checked', bool);
                        });
                    }
                }
            ),

            /**
             * 主元素被点击时的处理函数
             *
             * @fires module:BoxGroup#click
             * @param {Event} e 点击事件
             * @private
             */
            onClick: function (e) {

                var me = this;

                var $target = $(e.target);

                // 这里先将$input默认设定为$target，后面会修正，可以减少一次DOM查找
                var $input  = $target;

                var tagName = $target.prop('tagName');

                var isRadio = (me.boxType.toLowerCase() === 'radio');


                // 如果直接点击了input, i,那么我们需要向上选择到它的父结点label
                if (tagName === 'INPUT' || tagName === 'I') {
                    e.preventDefault() || (e.returnValue = false);
                    // 向上选择到label一层
                    $target = $target.parent();
                }
                else {
                    // 当点击的元素是LABEL，那么要阻止默认。。。
                    // 原理: 当label包含的for属性，或者label中包含中input时，
                    // 当label被点击时，浏览器会自动触发一次input完整真实的click事件
                    // 导致我们在外层监听的click监听事件处理函数被执行两次
                    // 这里可以通过阻止默认事件，来阻止上边描述的事情
                    // 但同时也阻止了浏览器对input状态的自动维护
                    // 好在我们可以自己处理
                    e.preventDefault() || (e.returnValue = false);
                    $input = $target.find('input');
                }

                // 复选点击同一个则反选,单选同一个则忽略

                //  单选同一个忽略
                if (isRadio &amp;&amp; $input.prop('checked')) {
                    return;
                }

                // 此时点击的是未选中的单选或者复选框 所以则反选

                var activeClass = me.activeClass;
                var $checkedItems = $(me.main).find('.' + activeClass);

                if (isRadio) {
                    // 单选保证选项中只有一个选项被选中
                    $checkedItems &amp;&amp; $checkedItems.removeClass(activeClass)
                                 .find('input').prop('checked', false);
                }

                var checked = !$target.hasClass(activeClass);
                $target.toggleClass(activeClass)
                       .find('input')
                       .prop('checked', checked);

                this.fire('change', {
                    target: this
                });

            },

            /**
             * 生成选项的HTML
             *
             * @param {boolean} state 元素是否被选中
             * @param {Object} item  需显示项的数据元素
             * @return {string} 返回生成的html
             * @public
             */
            getItemHTML: function (state, item) {
                var checkedClass = state ? (' ' + this.activeClass) : '';
                var icon = THEMEICON[this.styleClass];
                return ''
                    + '&lt;label class="' + this.styleClass + checkedClass + '">'
                    +     '&lt;i class="icon icon-un">' + icon.normal + '&lt;/i>'
                    +     '&lt;i class="icon icon-on">' + icon.expanded + '&lt;/i>'
                    +     '&lt;input type="' + this.boxType + '" value="' + item.value + '">'
                    +      item.name
                    + '&lt;/label>';
            },

            /**
             * 获得当前被选中的值
             *
             * @return {Array} 返回当前被选中的值
             * @public
             */
            getValue: function () {
                var value = [];
                var main = $(this.main);
                $('.' + this.activeClass + ' input', main).each(function () {
                    value.push($(this).prop('value'));
                });
                return value;
            },

            /**
             * 设定当前被选中的值
             *
             * @param {Array} value 需被选中的元素
             * @return {module:BoxGroup} 当前 BoxGroup 实例
             * @public
             */
            setValue: function (value) {

                this.value = null;

                return this.set('value', value);
            },

            /**
             * 销毁单复选框控件实例
             *
             * @override
             */
            dispose: function () {
                this.undelegate(this.main, 'click', 'label', this.onClick);
                Control.prototype.dispose.apply(this, arguments);
            }
        });

        return BoxGroup;
    }
);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BoxGroup.html">BoxGroup</a></li><li><a href="module-Button.html">Button</a></li><li><a href="module-ButtonCountdown.html">ButtonCountdown</a></li><li><a href="module-Calendar.html">Calendar</a></li><li><a href="module-City.html">City</a></li><li><a href="module-Context.html">Context</a></li><li><a href="module-Control.html">Control</a></li><li><a href="module-Cookie.html">Cookie</a></li><li><a href="module-Dialog.html">Dialog</a></li><li><a href="module-Form.html">Form</a></li><li><a href="module-FormFieldWatcher.html">FormFieldWatcher</a></li><li><a href="module-FormRelation.html">FormRelation</a></li><li><a href="module-FormSubmit.html">FormSubmit</a></li><li><a href="module-Helper.html">Helper</a></li><li><a href="module-Lazy.html">Lazy</a></li><li><a href="module-LazyImg.html">LazyImg</a></li><li><a href="module-Lazyload.html">Lazyload</a></li><li><a href="module-lib.html">lib</a></li><li><a href="module-log.html">log</a></li><li><a href="module-main.html">main</a></li><li><a href="module-Marquee.html">Marquee</a></li><li><a href="module-Mask.html">Mask</a></li><li><a href="module-Pager.html">Pager</a></li><li><a href="module-painter.html">painter</a></li><li><a href="module-Panel.html">Panel</a></li><li><a href="module-Plugin.html">Plugin</a></li><li><a href="module-Popup.html">Popup</a></li><li><a href="module-Rating.html">Rating</a></li><li><a href="module-ScrollBar.html">ScrollBar</a></li><li><a href="module-Select.html">Select</a></li><li><a href="module-Slider.html">Slider</a></li><li><a href="module-SliderAnim.html">SliderAnim</a></li><li><a href="module-Tab.html">Tab</a></li><li><a href="module-TabBar.html">TabBar</a></li><li><a href="module-Tag.html">Tag</a></li><li><a href="module-TextBox.html">TextBox</a></li><li><a href="module-TextBoxAutoComplete.html">TextBoxAutoComplete</a></li><li><a href="module-TextBoxPlaceHolder.html">TextBoxPlaceHolder</a></li><li><a href="module-Tip.html">Tip</a></li><li><a href="module-ValidateTip.html">ValidateTip</a></li><li><a href="module-Validator.html">Validator</a></li><li><a href="module-ValidityRule.html">ValidityRule</a></li></ul><h3>Classes</h3><ul><li><a href="Validity.html">Validity</a></li><li><a href="ValidityState.html">ValidityState</a></li></ul><h3>Events</h3><ul><li><a href="module-Calendar.html#event:hide">hide</a></li><li><a href="module-Calendar.html#event:pick">pick</a></li><li><a href="module-Calendar.html#event:show">show</a></li><li><a href="module-City.html#event:beforeShow">beforeShow</a></li><li><a href="module-City.html#event:pick">pick</a></li><li><a href="module-Control.html#event:afterdispose">afterdispose</a></li><li><a href="module-Control.html#event:afterrender">afterrender</a></li><li><a href="module-Control.html#event:beforedispose">beforedispose</a></li><li><a href="module-Control.html#event:beforerender">beforerender</a></li><li><a href="module-Control.html#event:disable">disable</a></li><li><a href="module-Control.html#event:enable">enable</a></li><li><a href="module-Control.html#event:statechange">statechange</a></li><li><a href="module-Dialog.html#event:dispose">dispose</a></li><li><a href="module-Dialog.html#event:hide">hide</a></li><li><a href="module-Form.html#event:submit">submit</a></li><li><a href="module-FormFieldWatcher.html#event:fieldchange%25E5%259F%259F%25E8%25BE%2593%25E5%2585%25A5%25E5%258F%2598%25E5%258C%2596%25E4%25BA%258B%25E4%25BB%25B6">fieldchange 域输入变化事件</a></li><li><a href="module-log.html#event:click">click</a></li><li><a href="module-log.html#event:send">send</a></li><li><a href="module-log.html#event:start">start</a></li><li><a href="module-Pager.html#event:change">change</a></li><li><a href="module-Popup.html#event:beforeshow">beforeshow</a></li><li><a href="module-Popup.html#event:click">click</a></li><li><a href="module-Popup.html#event:hide">hide</a></li><li><a href="module-Popup.html#event:show">show</a></li><li><a href="module-Rating.html#event:change">change</a></li><li><a href="module-Rating.html#event:hover">hover</a></li><li><a href="module-ScrollBar.html#event:change">change</a></li><li><a href="module-Select.html#event:change">change</a></li><li><a href="module-Slider.html#event:change">change</a></li><li><a href="module-Tab.html#event:change">change</a></li><li><a href="module-TextBox.html#event:autocomplete">autocomplete</a></li><li><a href="module-TextBox.html#event:autocompletebeforeshow">autocompletebeforeshow</a></li><li><a href="module-TextBox.html#event:autocompleteclick">autocompleteclick</a></li><li><a href="module-TextBox.html#event:autocompletehide">autocompletehide</a></li><li><a href="module-TextBox.html#event:autocompletepick">autocompletepick</a></li><li><a href="module-TextBox.html#event:autocompleteshow">autocompleteshow</a></li><li><a href="module-Validator.html#event:aftervalidate%25E6%25A0%25A1%25E9%25AA%258C%25E5%25AE%258C%25E6%2588%2590%25E4%25BA%258B%25E4%25BB%25B6">aftervalidate 校验完成事件</a></li><li><a href="module-Validator.html#event:beforevalidate">beforevalidate</a></li><li><a href="module-Validator.html#event:invalid%25E6%25A0%25A1%25E9%25AA%258C%25E4%25B8%258D%25E9%2580%259A%25E8%25BF%2587%25E4%25BA%258B%25E4%25BB%25B6">invalid 校验不通过事件</a></li><li><a href="module-Validator.html#event:valid%25E6%25A0%25A1%25E9%25AA%258C%25E9%2580%259A%25E8%25BF%2587%25E4%25BA%258B%25E4%25BB%25B6">valid 校验通过事件</a></li><li><a href="module-Validator.html#event:validating%25E6%25A0%25A1%25E9%25AA%258C%25E4%25B8%25AD%25E4%25BA%258B%25E4%25BB%25B6%25EF%25BC%258C%25E9%2592%2588%25E5%25AF%25B9%25E5%25BC%2582%25E6%25AD%25A5%25E6%25A0%25A1%25E9%25AA%258C%25E6%2589%258D%25E6%259C%2589">validating 校验中事件，针对异步校验才有</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-lib.browser.html">browser</a></li></ul><h3>Interfaces</h3><ul><li><a href="configurable.html">configurable</a></li><li><a href="observable.html">observable</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Tue Aug 11 2015 21:00:39 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
