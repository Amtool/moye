<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @copyright 2014 Baidu Inc. All rights reserved.
 *
 * @file moye主入口
 * @author Leon(ludafa@outlook.com)
 * @module main
 */

define(function (require) {

    var lib = require('./lib');
    var Context = require('./Context');

    /**
     * 控件库配置数据
     *
     * @type {Object}
     * @inner
     */
    var config = {

        // 配置属性前缀
        uiPrefix: 'data-ui',

        // 在渲染后, 我们会给main元素添加此属性, 其值为设定的id值
        instanceAttr: 'data-ctrl-id',

        // 主样式前缀
        uiClassPrefix: 'ui',

        // 皮肤样式前缀
        skinClassPrefix: 'skin',

        // 状态样式前缀
        stateClassPrefix: 'state',

        // 上下文属性名
        contextAttr: 'data-ctrl-context'
    };

    var defaultContext = Context.create('default');


    var exports = {

        /**
         * 依照配置, 初始化指定元素中的所有moye组件
         *
         * @public
         * @param  {Element} container  容器元素
         * @param  {Object}  properties 配置
         * @param  {module:Context} context    上下文
         * @return {Object}  容器内所有被初始化的组件实例
         */
        init: function (container, properties, context) {

            var confAttr = config.uiPrefix + '-id';
            var controls = {};

            // 先将参数放到上下文中存储起来
            context = context || defaultContext;
            context.fill(properties);


            $('[' + confAttr + ']', container).each(function (i, element) {

                var id         = element.getAttribute(confAttr);
                var instanceId = element.getAttribute(config.instanceAttr);

                // 元素上没有id标识, 或者已经有了实例ID标识, 跳过
                if (!id || instanceId) {
                    return;
                }

                var conf = properties[id];

                // 如果没有配置项, 跳过
                if (!conf) {
                    return;
                }

                var type = conf.type;

                // 如果配置项中没有指定`type`, 跳过
                if (!type) {
                    throw new Error('you should specify a type to `' + id + '`');
                }

                // 生成参数
                var options = $.extend(
                    // 整体配置的context优先级低于具体控件的配置
                    {
                        context: context
                    },
                    // 每个控件的配置
                    conf,
                    // 由于这两个属性是由DOM来决定的, 优先级最高
                    {
                        id: id,
                        main: element
                    }
                );

                // 生成控件实例
                var control = exports.create(type, options);

                // 渲染控件
                control.render();
                controls[id] = control;

            });

            return controls;
        },

        /**
         * 新建一个控件实例
         *
         * @public
         * @param  {string} type    控件类型
         * @param  {Object} options 控件参数
         * @return {module:Control}
         */
        create: function (type, options) {
            var Class = lib.getClass(type);
            if (!Class) {
                throw new Error('Class ' + type + ' not found');
            }
            delete options.type;
            return new Class(options);
        },

        /**
         * 获取指定Id的控件
         *
         * @public
         * @param  {string} instanceId 控件id
         * @return {module:Control}
         */
        get: function (instanceId) {
            return defaultContext.get(instanceId);
        },

        /**
         * 通过一个DOM元素(通常是控件的主元素)来获取控件实例
         *
         * @public
         * @param {Element} dom 控件主元素
         * @return {module:Control}
         */
        getControlByDOM: function (dom) {
            dom = $(dom);
            var instanceId = dom.attr(config.instanceAttr);

            if (!instanceId) {
                return;
            }

            var contextId = dom.attr(config.contextAttr);

            if (!contextId) {
                return;
            }

            var context = exports.getContext(contextId);

            if (!context) {
                return;
            }

            return context.get(instanceId);
        },

        /**
         * 获取上下文环境
         *
         * 如果未指定上下文环境id, 则返回默认上下文
         *
         * @public
         * @param  {string} contextId 上下文ID
         * @return {module:Context}
         */
        getContext: function (contextId) {
            return contextId ? Context.get(contextId) : defaultContext;
        },

        /**
         * 取配置
         *
         * @public
         * @param  {string} name 配置属性名
         * @return {*}
         */
        getConfig: function (name) {
            return config[name];
        },

        /**
         * 设定配置
         *
         * @public
         * @param {string} name  配置属性名
         * @param {*}      value 配置属性值
         * @return {module:Control}
         */
        setConfig: function (name, value) {
            config[name] = value;
            return this;
        }

    };

    return exports;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BoxGroup.html">BoxGroup</a></li><li><a href="module-Button.html">Button</a></li><li><a href="module-ButtonCountdown.html">ButtonCountdown</a></li><li><a href="module-Calendar.html">Calendar</a></li><li><a href="module-City.html">City</a></li><li><a href="module-Context.html">Context</a></li><li><a href="module-Control.html">Control</a></li><li><a href="module-Cookie.html">Cookie</a></li><li><a href="module-Dialog.html">Dialog</a></li><li><a href="module-Form.html">Form</a></li><li><a href="module-FormFieldWatcher.html">FormFieldWatcher</a></li><li><a href="module-FormRelation.html">FormRelation</a></li><li><a href="module-FormSubmit.html">FormSubmit</a></li><li><a href="module-Helper.html">Helper</a></li><li><a href="module-Lazy.html">Lazy</a></li><li><a href="module-LazyImg.html">LazyImg</a></li><li><a href="module-Lazyload.html">Lazyload</a></li><li><a href="module-lib.html">lib</a></li><li><a href="module-log.html">log</a></li><li><a href="module-main.html">main</a></li><li><a href="module-Marquee.html">Marquee</a></li><li><a href="module-Mask.html">Mask</a></li><li><a href="module-Pager.html">Pager</a></li><li><a href="module-painter.html">painter</a></li><li><a href="module-Panel.html">Panel</a></li><li><a href="module-Plugin.html">Plugin</a></li><li><a href="module-Popup.html">Popup</a></li><li><a href="module-RangeSlider.html">RangeSlider</a></li><li><a href="module-Rating.html">Rating</a></li><li><a href="module-ScrollBar.html">ScrollBar</a></li><li><a href="module-Select.html">Select</a></li><li><a href="module-Slider.html">Slider</a></li><li><a href="module-SliderAnim.html">SliderAnim</a></li><li><a href="module-Tab.html">Tab</a></li><li><a href="module-TabBar.html">TabBar</a></li><li><a href="module-Tag.html">Tag</a></li><li><a href="module-TextBox.html">TextBox</a></li><li><a href="module-TextBoxAutoComplete.html">TextBoxAutoComplete</a></li><li><a href="module-TextBoxPlaceHolder.html">TextBoxPlaceHolder</a></li><li><a href="module-Tip.html">Tip</a></li><li><a href="module-ValidateTip.html">ValidateTip</a></li><li><a href="module-Validator.html">Validator</a></li><li><a href="module-ValidityRule.html">ValidityRule</a></li></ul><h3>Classes</h3><ul><li><a href="Validity.html">Validity</a></li><li><a href="ValidityState.html">ValidityState</a></li></ul><h3>Events</h3><ul><li><a href="module-Calendar.html#event:hide">hide</a></li><li><a href="module-Calendar.html#event:pick">pick</a></li><li><a href="module-Calendar.html#event:show">show</a></li><li><a href="module-City.html#event:beforeShow">beforeShow</a></li><li><a href="module-City.html#event:pick">pick</a></li><li><a href="module-Control.html#event:afterdispose">afterdispose</a></li><li><a href="module-Control.html#event:afterrender">afterrender</a></li><li><a href="module-Control.html#event:beforedispose">beforedispose</a></li><li><a href="module-Control.html#event:beforerender">beforerender</a></li><li><a href="module-Control.html#event:disable">disable</a></li><li><a href="module-Control.html#event:enable">enable</a></li><li><a href="module-Control.html#event:statechange">statechange</a></li><li><a href="module-Dialog.html#event:dispose">dispose</a></li><li><a href="module-Dialog.html#event:hide">hide</a></li><li><a href="module-Form.html#event:submit">submit</a></li><li><a href="module-FormFieldWatcher.html#event:fieldchange%25E5%259F%259F%25E8%25BE%2593%25E5%2585%25A5%25E5%258F%2598%25E5%258C%2596%25E4%25BA%258B%25E4%25BB%25B6">fieldchange 域输入变化事件</a></li><li><a href="module-log.html#event:click">click</a></li><li><a href="module-log.html#event:send">send</a></li><li><a href="module-log.html#event:start">start</a></li><li><a href="module-Pager.html#event:change">change</a></li><li><a href="module-Popup.html#event:beforeshow">beforeshow</a></li><li><a href="module-Popup.html#event:click">click</a></li><li><a href="module-Popup.html#event:hide">hide</a></li><li><a href="module-Popup.html#event:show">show</a></li><li><a href="module-RangeSlider.html#event:change">change</a></li><li><a href="module-RangeSlider.html#event:end%25E6%25BB%2591%25E5%258A%25A8%25E7%25BB%2593%25E6%259D%259F%25E4%25BA%258B%25E4%25BB%25B6">end 滑动结束事件</a></li><li><a href="module-RangeSlider.html#event:sliding%25E6%25BB%2591%25E5%259D%2597%25E6%25BB%2591%25E5%258A%25A8%25E4%25BA%258B%25E4%25BB%25B6">sliding 滑块滑动事件</a></li><li><a href="module-RangeSlider.html#event:start%25E6%25BB%2591%25E5%258A%25A8%25E5%25BC%2580%25E5%25A7%258B%25E4%25BA%258B%25E4%25BB%25B6">start 滑动开始事件</a></li><li><a href="module-Rating.html#event:change">change</a></li><li><a href="module-Rating.html#event:hover">hover</a></li><li><a href="module-ScrollBar.html#event:change">change</a></li><li><a href="module-Select.html#event:change">change</a></li><li><a href="module-Slider.html#event:change">change</a></li><li><a href="module-Tab.html#event:change">change</a></li><li><a href="module-TextBox.html#event:autocomplete">autocomplete</a></li><li><a href="module-TextBox.html#event:autocompletebeforeshow">autocompletebeforeshow</a></li><li><a href="module-TextBox.html#event:autocompleteclick">autocompleteclick</a></li><li><a href="module-TextBox.html#event:autocompletehide">autocompletehide</a></li><li><a href="module-TextBox.html#event:autocompletepick">autocompletepick</a></li><li><a href="module-TextBox.html#event:autocompleteshow">autocompleteshow</a></li><li><a href="module-Validator.html#event:aftervalidate%25E6%25A0%25A1%25E9%25AA%258C%25E5%25AE%258C%25E6%2588%2590%25E4%25BA%258B%25E4%25BB%25B6">aftervalidate 校验完成事件</a></li><li><a href="module-Validator.html#event:beforevalidate">beforevalidate</a></li><li><a href="module-Validator.html#event:invalid%25E6%25A0%25A1%25E9%25AA%258C%25E4%25B8%258D%25E9%2580%259A%25E8%25BF%2587%25E4%25BA%258B%25E4%25BB%25B6">invalid 校验不通过事件</a></li><li><a href="module-Validator.html#event:valid%25E6%25A0%25A1%25E9%25AA%258C%25E9%2580%259A%25E8%25BF%2587%25E4%25BA%258B%25E4%25BB%25B6">valid 校验通过事件</a></li><li><a href="module-Validator.html#event:validating%25E6%25A0%25A1%25E9%25AA%258C%25E4%25B8%25AD%25E4%25BA%258B%25E4%25BB%25B6%25EF%25BC%258C%25E9%2592%2588%25E5%25AF%25B9%25E5%25BC%2582%25E6%25AD%25A5%25E6%25A0%25A1%25E9%25AA%258C%25E6%2589%258D%25E6%259C%2589">validating 校验中事件，针对异步校验才有</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-lib.browser.html">browser</a></li></ul><h3>Interfaces</h3><ul><li><a href="configurable.html">configurable</a></li><li><a href="observable.html">observable</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Mon Aug 10 2015 17:04:33 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
