/*! 2015 Baidu Inc. All Rights Reserved */
define("moye/ui/Lazyload",["require","jquery","./lib"],function(require){var t=require("jquery"),e=require("./lib"),i={compute:function(){var i={x:e.getScrollLeft(),y:e.getScrollTop()},n={x:e.getViewWidth(),y:e.getViewHeight()},s=this;if(this.imgs&&this.imgs.length)if(this.imgs=t.grep(this.imgs,function(r){var a=t(r),o=a.attr(s.src),h=a.offset();h.right=h.left+a.width(),h.bottom=h.top+a.height();var u=h.left-s.offset.x>=i.x+n.x,l=h.top-s.offset.y>=i.y+n.y,c=h.right+s.offset.x<=i.x,f=h.bottom+s.offset.y<=i.y;if(!(u||l||c||f)){var p=document.createElement("img");return p.onload=function(t){if(e.isFunction(s.effect))return s.effect(r),void s.onLoad(r);else return a.hide(),a.attr("src",o),a.removeAttr(s.src),a[s.effect](s.effectSpeed,function(){s.onLoad(r)}),void(p=null)},p.onerror=s.onError,p.src=o,!1}return!0}),!this.imgs.length)this.dispose()},onScroll:function(){clearTimeout(this._timer),this._timer=setTimeout(this._bound.compute,this.delay),this.scrolled=!0,this._bound.compute()}},n=e.newClass({type:"Lazyload",tag:"data-lazyload-id",options:{main:"body",src:"_src",imgs:null,delay:100,effect:"show",effectSpeed:0,offset:{y:32,x:0},onLoad:t.noop,onError:t.noop},initialize:function(e){this.setOptions(e);var n=this.main=t(e.main||document.body)[0];this.imgs=e.imgs||t("img["+this.src+"]",n).toArray(),this._bound={onScroll:t.proxy(i.onScroll,this),compute:t.proxy(i.compute,this)},this.add()},add:function(i){var n=this;if(i=i||[],!e.isArray(i))i=[i];if(i=t.grep(i,function(e){return"img"===e.tagName.toLowerCase()&&t(e).attr(n.src)}),this.imgs=this.imgs.concat(i),this.imgs.length)t(window).on("scroll",this._bound.onScroll),t(window).on("resize",this._bound.onScroll);if(!this.scrolled)this._bound.onScroll();return this},remove:function(i){var n=this;if(!e.isArray(i))i=[i];if(e.each(i,function(e){var i=t.inArray(e,n.imgs);if(-1!==i)n.imgs.splice(i,1)}),!n.imgs.length)n.dispose();return n},dispose:function(){return t(window).off("scroll",this._bound.onScroll),t(window).off("resize",this._bound.onScroll),this.scrolled=!1,this}}).implement(e.configurable);return n});