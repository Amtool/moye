/*! 2015 Baidu Inc. All Rights Reserved */
define("moye/City",["require","jquery","./lib","./Control","./Popup","./painter"],function(require){var t=require("jquery"),e=require("./lib"),i=require("./Control"),a=require("./Popup"),n=["热门|上海,北京,广州,昆明,西安,成都,深圳,厦门,乌鲁木齐,南京,重庆,杭州,大连,长沙,海口,哈尔滨,青岛,沈阳,三亚,济南,武汉,郑州,贵阳,南宁,福州,天津,长春,石家庄,太原,兰州","A-G|安庆,阿勒泰,安康,鞍山,安顺,安阳,阿克苏,包头,蚌埠,北海,北京,百色,保山,博乐,长治,长春,长海,常州,昌都,朝阳,潮州,常德,长白山,成都,重庆,长沙,赤峰,大同,大连,达县,大足,东营,大庆,丹东,大理,敦煌,鄂尔多斯,恩施,二连浩特,佛山,福州,阜阳,富蕴,贵阳,桂林,广州,广元,赣州,格尔木,广汉,固原","H-L|呼和浩特,哈密,黑河,海拉尔,哈尔滨,海口,衡阳,黄山,杭州,邯郸,合肥,黄龙,汉中,和田,惠州,吉安,吉林,酒泉,鸡西,晋江,锦州,景德镇,嘉峪关,井冈山,济宁,九江,佳木斯,济南,喀什,昆明,康定,克拉玛依,库尔勒,喀纳斯,库车,兰州,洛阳,丽江,梁平,荔波,庐山,林芝,柳州,泸州,连云港,黎平,连城,拉萨,临沧,临沂","M-T|牡丹江,芒市,满洲里,绵阳,梅县,漠河,南京,南充,南宁,南阳,南通,那拉提,南昌,宁波,攀枝花,衢州,秦皇岛,庆阳,且末,齐齐哈尔,青岛,汕头,深圳,石家庄,三亚,沈阳,上海,思茅,鄯善,韶关,沙市,苏州,唐山,铜仁,通化,塔城,腾冲,台州,天水,天津,通辽,太原,吐鲁番","W-Z|威海,武汉,梧州,文山,无锡,潍坊,武夷山,乌兰浩特,温州,乌鲁木齐,芜湖,万州,乌海,兴义,西昌,厦门,香格里拉,西安,襄阳,西宁,锡林浩特,西双版纳,徐州,兴城,兴宁,邢台,义乌,永州,榆林,延安,运城,烟台,银川,宜昌,宜宾,盐城,延吉,玉树,伊宁,伊春,珠海,昭通,张家界,舟山,郑州,中卫,芷江,湛江,中甸,遵义"],s=i.extend({type:"City",options:{index:0,activeClass:"active",autoFill:!0,hideCities:null},init:function(t){this.$parent(t);var e=this.main;if(e&&"INPUT"===e.tagName){var i=document.createElement("div"),a=e.parentNode;if(a)a.insertBefore(i,e);i.appendChild(e),this.input=e,this.main=i}this.tabs=this.autoFill?n.slice():[]},initStructure:function(){var e=t(this.main),i=this.input;if(!i)i=this.input=t('<input type="text">').appendTo(e).get(0);if(i.setAttribute("autocomplete","off"),this.name)i.name=this.name;var n=this.popup=new a({target:i,triggers:[i]}).render();this.helper.addPartClasses("popup",n.main)},initEvents:function(){this.popup.on("click",t.proxy(this._onPopupClick,this)).on("show",t.proxy(this._onPopupShow,this))},setReadOnly:function(t){this.$parent(t),this.input.readOnly=!!t},repaint:require("./painter").createRepaint(i.prototype.repaint,{name:"value",paint:function(t,e){this.setValue(e)}}),fill:function(t){var i=this.tabs;if(e.isString(t))i.push(t);else this.tabs=t;return this},_pick:function(e){var i=e.innerHTML,a=new t.Event("pick",{target:this,value:i});if(this.fire(a),!a.isDefaultPrevented()){var n=this.input;n.value=i,n.focus(),this.hide(),this.fire("change")}},_changeTab:function(e){var i=this.labels,a=this.panels,n=this.index,s=this.helper.getPartClassName(this.activeClass);if(e!==n)t(i[n]).removeClass(s),t(a[n]).removeClass(s),n=this.index=e,t(i[n]).addClass(s),t(a[n]).addClass(s)},show:function(t){this.popup.show()},hide:function(){this.popup.hide()},setValue:function(t){return this.input.value=t||"",this},getValue:function(){return this.input.value},_onPopupClick:function(e){var i=t(e.target),a=i.prop("tagName"),n=i.data("idx"),s=this.helper.getPartClassName(this.activeClass);switch(a){case"A":e.preventDefault(),i.hasClass(s)?this.hide():this._pick(e.target);break;case"LI":if(n!==this.index)this._changeTab(n)}},_onPopupShow:function(e){if(!this.isDisabled()){var i=new t.Event("show");if(this.fire(i),i.isDefaultPrevented())return void e.preventDefault();if(!this.labels){var a=this.popup;a.set("content",this._build(this.tabs));var n=a.main.getElementsByTagName("ul");this.labels=n[0].getElementsByTagName("li"),this.panels=n[1].getElementsByTagName("li")}}},_build:function(t){var i=this.helper,a=this.index,n=[],s=[];n.push('<ul class="'+i.getPartClassName("labels")+'">'),s.push('<ul class="'+i.getPartClassName("panels")+'">');var r=",",h=this.hideCities;if(h)h=r+h.replace(/\s+/g,"")+r;var o=function(t){return e.map(t.split(r),function(t){return!h||!~h.indexOf(r+t+r)?'<a href="#" title="'+t+'">'+t+"</a>":""}).join("")},u=i.getPartClassName(this.activeClass);return e.each(this.tabs,function(t,e){var i='<li data-idx="'+e+'" class="'+(e===a?u:"")+'"';t=t.split("|"),n.push(i+">"+t[0]+"</li>"),s.push(i+">"+o(t[1])+"</li>")}),n.push("</ul>"),s.push("</ul>"),n.join("")+s.join("")}});return s});