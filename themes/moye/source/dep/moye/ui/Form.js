/*! 2015 Baidu Inc. All Rights Reserved */
define("moye/Form",["require","jquery","./lib","./Panel","./painter"],function(require){function t(t){return"FORM"===t.tagName}function e(t){var e=new i.Event("submit");if(t.fire(e),!e.isDefaultPrevented())t.main.submit()}var i=require("jquery"),n=require("./lib"),s=require("./Panel"),a=s.extend({type:"Form",options:{action:"",method:"GET",target:"_self"},createMain:function(){return document.createElement("form")},init:function(t){this.$parent(t),this.action=this.action||this.main.action,this.target=this.target||this.main.target},initStructure:function(){var e=this.main;if(t(e))e.method=this.method||e.method},initEvents:function(){if(t(this.main))this.delegate(this.main,"submit",this.onSubmit)},repaint:require("./painter").createRepaint(s.prototype.repaint,{name:"action",paint:function(t,e){this.main.action=e}},{name:"target",paint:function(t,e){this.main.target=e||""}}),onSubmit:function(t){t.preventDefault(),this.submit()},submit:function(){var i=this;if(t(i.main)){var s=i.validate();if(n.isPromise(s))s.then(function(t){t&&e(i)});else if(s)e(i);return this}},getData:function(){var t=this.getInputControls(),e={};return n.each(t,function(t){if(!t.isDisabled()){var i=t.name,n=t.getValue();if(e.hasOwnProperty(i))e[i]=[].concat(e[i],n);else e[i]=n}}),e},getInputControls:function(){var t=[],e=this.context,s=this.children||[];return i.each(s,function(i,s){if(s&&s.name&&n.isFunction(s.getValue)&&s.context===e)t.push(s)}),t},check:function(t){for(var e=!1,s=!0,a=[],r=r=this.getInputControls(),h=0,o=r.length;o>h;h++){var u=r[h][t],l=u?u():!0;if(a[h]=l,s&&!l)s=!1;else if(!e)e=n.isPromise(l)}if(e)return i.when.apply(null,a).then(function(){for(var t=arguments.length-1;t>=0;t--)if(!arguments[t])return!1;return!0});else return s},validate:function(){return this.check("validate")},checkValidity:function(){return this.check("checkValidity")},dispose:function(){if(t(this.main))this.undelegate(this.main,"submit",this.onSubmit);this.$parent()}});return a});