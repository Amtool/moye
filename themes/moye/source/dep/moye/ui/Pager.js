/*! 2015 Baidu Inc. All Rights Reserved */
define("moye/ui/Pager",["require","jquery","./Control","./painter","./lib"],function(require){var t=require("jquery"),i=require("./Control"),e=require("./painter"),n=require("./lib"),s=i.extend({type:"Pager",options:{page:0,first:0,padding:1,showAlways:!0,showCount:5,total:0,disabledClass:"disabled",anchor:"",mode:"normal",lang:{prev:"上一页",next:"下一页",ellipsis:".."}},init:function(i){var e=t(this.main);this.$parent(i),this.showCount=+this.showCount,this.total=+this.total||+e.data("total")||0,this.padding=+this.padding||1,this.first=+this.first||+e.data("first")||0,this.page=+this.page||+e.data("page")||+this.first},initEvents:function(){this.delegate(this.main,"click","a",this.onMainClicked)},repaint:e.createRepaint(i.prototype.repaint,{name:["page","total"],paint:function(i,e,n){var s=t(this.main);if(!this.helper.isInStage("INITED")||!s.data("click"))if(this.page=Math.max(Math.min(e,this.total-1+this.first),this.first),2>n&&!this.showAlways)s.hide();else s.html(this.build()).show()}}),setPage:function(t){this.page=null,this.set("page",t)},getPage:function(){return this.page},setTotal:function(t){this.set({page:this.first,total:+t})},getTotal:function(){return this.total},getItemHTML:function(t,i){var e=this.getItemClassName(n.slice(arguments,1).concat("item")),s=t,r=this.getItemAnchor(s);if(!this.lang[i])if(this.getPageItemHTML)return this.getPageItemHTML(s,i);else if("simple"===this.mode)return'<span class="'+e+'">'+this.getItemText(t+1-this.first,"item")+"/"+this.total+"</span>";return'<a href="'+r+'" data-page="'+s+'" class="'+e+'">'+this.getItemText(t+1-this.first,i||"item")+"</a>"},getPageItemHTML:null,getItemText:function(t,i){return this.lang[i]||t},getItemClassName:function(t){var i=this.helper;return n.map(t,function(t){return t?i.getPartClassName(t):""}).join(" ")},getItemAnchor:function(t){if(!this.anchor)return"#";if(~this.anchor.indexOf("?"))return this.anchor+"&page="+t;else return this.anchor+"?page="+t},build:function(){var t=this.page-this.first,i=this.total,e=this.padding,s=this.showCount;s=s>i?i:s;var r=Math.floor(s/2),a=e,h=r,o=e,u=r,l=t-r;if(0>l)h+=l,u-=l;var c=t+r+1-i;if(c>0)h+=c,u-=c;var p;if("normal"===this.mode){var f=this.range(0,t,a,h),d=this.range(t+1,i,u,o);p=n.map(f.concat(t).concat(d),function(i){return 0>i?this.getItemHTML(-i+this.first,"ellipsis"):this.getItemHTML(i+this.first,i===t?"current":"")},this)}else if("simple"===this.mode)p=[this.getItemHTML(this.page,"item")];return""+this.getItemHTML(Math.max(t-1,0)+this.first,"prev",t>0?"":"disabled")+p.join("")+this.getItemHTML(Math.min(t+1,i-1)+this.first,"next",i-1>t?"":"disabled")},range:function(t,i,e,s){return i-s>t+e?n.range(t,t+e).concat(-t-e).concat(n.range(i-s,i)):n.range(t,i)},onMainClicked:function(i){var e=t(i.currentTarget),n=this.helper;if(!e.length||e.hasClass(n.getPrimaryClassName("current"))||e.hasClass(n.getPrimaryClassName("disabled")))return!1;var s=e.data("page"),r=this.fire("change",{page:s});if(!this.anchor)if(!r.isDefaultPrevented())i.preventDefault(),this.set("page",s)},dispose:function(){this.undelegate(this.main,"click","a",this.onMainClicked),this.$parent(),t(this.main).html("")}});return s});