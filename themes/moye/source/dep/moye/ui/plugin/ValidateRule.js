/*! 2015 Baidu Inc. All Rights Reserved */
define("moye/ui/plugin/ValidateRule",["require","./ValidityState","../lib"],function(require){function t(t,e){if(e instanceof n)return e;var i;if(s.isString(e))i={state:!1,message:e};else if(s.isBoolean(e)||s.isNumber(e))i={state:!!e};else e||(e={}),i={state:!!e.state,message:e.message};if(!i.message)i.message=this.getMessage(t,i.state);return new n(i.state,i.message)}function e(t){return function(e,i){var s=t.test(e);return new n(s,this.getMessage(i,s))}}function i(e){return function(i,n){var r=this,a=e.call(r,i,n);if(s.isPromise(a))return a.then(function(e){return t.call(r,n,e)},function(e){return t.call(r,n,e)});else return t.call(r,n,a)}}var n=require("./ValidityState"),s=require("../lib"),r={},a=s.newClass({$class:"ValidityRule",options:{message:{invalid:"!{title}格式不符合要求"}},initialize:function(t){if(s.isRegExp(t)||s.isFunction(t))t={check:t};else if(s.isString(t))t={type:t};var n=t.type,a=r[n];if(n&&!a)throw new Error("ValidateRule ["+n+"] cannot be found");if(t=s.extend({},a||this.options,t),s.isRegExp(t.check))t.check=e(t.check);else if(s.isFunction(t.check))t.check=i(t.check);if(s.isString(t.message))t.message={invalid:t.message};s.extend(this,t)},getMessage:function(t,e){var i=e?"valid":"invalid",n=this.message||t[this.type+s.capitalize(i)+"Message"];if(s.isFunction(n))return n.call(this,t,e);var r=s.isString(n)?n:n[i],a=this,o=function(e){var i=a[e];return null==i&&(i=t[e]),i};return r?s.format(r,o):""},check:function(t,e){throw new Error("`check` must be implemented")}});return a.register=function(t,e){return r[t]=e,this},a});