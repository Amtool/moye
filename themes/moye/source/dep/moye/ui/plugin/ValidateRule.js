/*! 2015 Baidu Inc. All Rights Reserved */
define("moye/plugin/ValidateRule",["require","./ValidityState","../lib"],function(require){function t(t,e){if(e instanceof n)return e;var i;if(r.isString(e))i={state:!1,message:e};else if(r.isBoolean(e)||r.isNumber(e))i={state:!!e};else e||(e={}),i={state:!!e.state,message:e.message};if(!i.message)i.message=this.getMessage(t,i.state);return new n(i.state,i.message)}function e(t){return function(e,i){var r=t.test(e);return new n(r,this.getMessage(i,r))}}function i(e){return function(i,n){var s=this,a=e.call(s,i,n);if(r.isPromise(a))return a.then(function(e){return t.call(s,n,e)},function(e){return t.call(s,n,e)});else return t.call(s,n,a)}}var n=require("./ValidityState"),r=require("../lib"),s={},a=r.newClass({$class:"ValidityRule",options:{message:{invalid:"!{title}格式不符合要求"}},initialize:function(t){if(r.isRegExp(t)||r.isFunction(t))t={check:t};else if(r.isString(t))t={type:t};var n=t.type,a=s[n];if(n&&!a)throw new Error("ValidateRule ["+n+"] cannot be found");if(t=r.extend({},a||this.options,t),r.isRegExp(t.check))t.check=e(t.check);else if(r.isFunction(t.check))t.check=i(t.check);if(r.isString(t.message))t.message={invalid:t.message};r.extend(this,t)},getMessage:function(t,e){var i=e?"valid":"invalid",n=this.message||t[this.type+r.capitalize(i)+"Message"];if(r.isFunction(n))return n.call(this,t,e);var s=r.isString(n)?n:n[i];return s?r.format(s,t,this):""},check:function(t,e){throw new Error("`check` must be implemented")}});return a.register=function(t,e){return s[t]=e,this},a});