/*! 2015 Baidu Inc. All Rights Reserved */
define("moye/ui/log",["require","jquery","./lib"],function(require){var t=require("jquery"),e=require("./lib"),i=function(t){try{return new Function("return ("+t+")")()}catch(e){return{}}},n=function(){var e=[];return function(i){var n=e.push(document.createElement("img"))-1;e[n].onload=e[n].onerror=function(){e[n]=e[n].onload=e[n].onerror=null,delete e[n]};var s=o.action+t.param(i);e[n].src=s+"&"+(+new Date).toString(36),exports.fire("send",{url:s})}}(),s=function(e,n,s){var o,h,l=0,u=n,c=[],f=u.getAttribute("data-rsv");if(f)e.rsv=t.extend(e,{rsv:i(f)});for(var d,p=0,m=/\bOP_LOG_(TITLE|LINK|IMG|BTN|INPUT|OTHERS)\b/i;u!==s;){if("1"===u.getAttribute("data-nolog")){l=1;break}if(d=u.getAttribute("data-click"))e=t.extend(i(d),e);if(f=u.getAttribute("data-rsv"))e.rsv=t.extend(i(f),e.rsv);if(u.href)h=u.href,o="link";if("link"===o&&"H3"===u.tagName)o="title";if(m.test(u.className))o=RegExp.$1.toLowerCase();var g=1;if(u.previousSibling){var v=u.previousSibling;do{if(1===v.nodeType&&v.tagName===u.tagName)g++;v=v.previousSibling}while(v)}c[p++]=u.tagName+(g>1?g:""),u=u.parentNode}if(n!==s)if(d=s.getAttribute("data-click"))e=t.extend(i(d),e);if(l)return!l;c.reverse();var y=n.tagName.toLowerCase();if(!o&&/^(a|img|input|button|select|datalist|textarea)$/.test(y))o={a:"link"}[y]||"input",h=n.href||n.src||h;if(o=n.getAttribute("data-type")||o,!o)return!1;if(h)e.url=h;return a(e,n,"p1"),a(e,n,"act"),a(e,n,"item"),a(e,n,"mod",s.id),r(e,n,o,y,c,p),e.xpath=c.join("-").toLowerCase()+"("+o+")",e},r=function(e,i,n,s,r,a){var o="",h=function(t){return t.getAttribute("data-title")||t.title||t.textContent||t.innerText||""};if("input"===n)if(/input|textarea/.test(s)){if(o=i.value,i.type&&"password"===i.type.toLowerCase())o=""}else if(/select|datalist/.test(s)){if(i.children.length>0){var l=i.selectedIndex||0;o=i.children[l>-1?l:0].innerHTML}}else o=h(i)||i.value||"";else if(o=h(i),!o)for(var u=i,c=a;c>0;)if(c--,/^a\d*\b/i.test(r[c])){e.url=u.href,o=h(u);break}else{if(u.className&&/\bOP_LOG_[A-Z]+\b/.test(u.className)){o=h(u);break}u=u.parentNode}e.txt=t.trim(o).replace(/<[^>]+?>/g,"")},a=function(t,e,i,n){t[i]=e.getAttribute("data-"+i)||t[i]||n||"-"},o={action:"http://nsclick.baidu.com/v.gif?",main:"result-op",title:"OP_LOG_TITLE",link:"OP_LOG_LINK",img:"OP_LOG_IMG",btn:"OP_LOG_BTN",input:"OP_LOG_INPUT",others:"OP_LOG_OTHERS",data:{url:(window.location||document.location||{href:"-"}).href,pid:"-",cat:"-",page:"-",fr:"-",pvid:"-",rqid:"-",qid:"-",psid:"-",sid:"-",pn:"-",act:"-",mod:"-",item:"-",p1:"-",xpath:"-",f:"-",txt:"-",q:"-",rsv:null}},h=function(t,n){var s=i(t.getAttribute("data-click"));s.p1=n,t.setAttribute("data-click",e.stringify(s))},l=function(e,r){var a=t(r||e.target),l=o.main,u=t(a).closest("."+l);if(u.length&&"1"!==u.attr("data-nolog")){var c=a.attr("data-click");if(c)c=i(c);if(c=s(c||{},a[0],u[0])){if(o.data)c=t.extend({},o.data,c);if(!("p1"in c))t("."+o.main).each(function(t,e){if(e===u)c.p1=t+1;h(e,t+1)});exports.fire("click",{data:c,target:a[0],main:u[0]}),n(c)}}},exports={config:function(e){return t.extend(o,e),this},start:function(){return t(document).on("mousedown",l),this.fire("start"),this},stop:function(){return t(document).off("mousedown",l),this},click:function(t){return l(null,t),this},fill:function(n,s){for(var r,a,o=0;r=n[o++];){if(a=r.getAttribute("data-click"))s=t.extend(i(a),s);r.setAttribute("data-click",e.stringify(s))}return this},live:function(e){var i=this.map;if(!i)i=this.map={},this.on("click",function(t){var e=t.data.mod;if(e&&e in i)i[e](t)});return t.extend(i,e),this},send:function(i){return n(t.extend(e.clone(o.data),i)),this}};return t.extend(exports,e.observable),exports});