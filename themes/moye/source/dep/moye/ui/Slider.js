/*! 2015 Baidu Inc. All Rights Reserved */
define("moye/ui/Slider",["require","jquery","./lib","./Control","./SliderAnim"],function(require){var t=require("jquery"),e=require("./lib"),i=require("./Control"),s=require("./SliderAnim"),n=i.extend({type:"Slider",options:{main:"",prev:"&lt;",next:"&gt;",arrow:!0,pager:!0,pagerOptions:{trigger:"click"},auto:!0,circle:!0,autoInterval:2e3,switchDelay:50,anim:"slide",animOptions:{easing:"easing",interval:200,direction:"horizontal",rollCycle:""}},init:function(t){this.$parent(t),this.auto&&(this.circle=!0);var i=e.isString(this.anim)?s.anims[this.anim]:this.anim;this.curAnim=new i(this,this.animOptions)},initStructure:function(){var e=this.helper,i=t('[data-role="stage"]',this.main);if(this.stage=i.get(0),!this.stage)throw"cannot find stage container";e.addPartClasses("stage",this.stage);var s=i.children().addClass(e.getPartClassName("item"));this.capacity=s.length,this.stageWidth=s.width(),this.stageHeight=s.height(),this.index=0;var n=this.capacity;if(n>0){if(this.arrow)this.addArrow("prev",this.prev),this.addArrow("next",this.next);if(this.pager)this.addPager(n)}this.updateControlPart(0,0)},addArrow:function(e,i){var s=t(this.helper.createPart(e,"i",i));this[e+"Arrow"]=s.appendTo(this.main).css("marginTop",-s.height()/2).get(0)},addPager:function(i){var s=this.helper,n=this.pager;if(e.isElement(n))this.pager=n,n=t(n).addClass(s.getPartClassName("pager")),n.attr("id",n.attr("id")||s.getPartId());else{for(var a=[],r=0;i>r;r++)a.push('<i data-index="'+r+'"></i>');n=t(this.helper.createPart("pager","div",a.join("")))}this.pager=n.appendTo(this.main).css("marginLeft",-n.width()/2).get(0)},initEvents:function(){var t=this.main;if(this.delegate(t,"mouseenter",this.onEnter).delegate(t,"mouseleave",this.onLeave),this.arrow)this.delegate(this.prevArrow,"click",this.onPrevClick),this.delegate(this.nextArrow,"click",this.onNextClick);if(this.pager)switch(this.pagerOptions.trigger){case"click":this.delegate(this.pager,"click",this.onPagerClick);break;case"hover":this.delegate(this.pager,"mouseenter","[data-index]",this.onPagerClick)}if(this.auto)this.play()},clearSwitchDelayTimer:function(){clearTimeout(this._switchDelayTimer),this._switchDelayTimer=0},onEnter:function(){if(this.auto)this.stop()},onLeave:function(){if(this.auto)this.play()},onPrevClick:function(){var t=this;if(!t._switchDelayTimer)t._switchDelayTimer=setTimeout(function(){t.clearSwitchDelayTimer(),t.goPrev()},t.switchDelay)},onNextClick:function(){var t=this;if(!t._switchDelayTimer)t._switchDelayTimer=setTimeout(function(){t.clearSwitchDelayTimer(),t.goNext()},t.switchDelay)},onPagerClick:function(t){var e=this,i=t.target,s=i.getAttribute("data-index")+"";if(s&&!e._switchDelayTimer)e._switchDelayTimer=setTimeout(function(){e.clearSwitchDelayTimer(),e.go(+s)},e.switchDelay)},getNextPage:function(t){var e=this.index,i=this.capacity,s=this.circle;if("start"===t)t=0;else if("end"===t)t=this.capacity-1;else t=+t||0;if(t===e)return-1;if(t>=i)t=s?0:i-1;else if(0>t)t=s?i-1:0;return t},isPlaying:function(){return!!this.timer},play:function(){var t=this;if(!t.isPlaying())t.timer=setInterval(function(){t.goNext()},t.autoInterval)},stop:function(){if(this.isPlaying())clearInterval(this.timer),this.timer=null},goPrev:function(){return this.go(this.index-1),this},goNext:function(){return this.go(this.index+1),this},go:function(t){var e=this.index;if(t===e)return this;if(t=this.getNextPage(t),!(0>t||!1===this.curAnim.switchTo(t,e)))this.index=t,this.updateControlPart(e,t),this.fire("change",{index:t,lastIndex:e})},updateControlPart:function(e,i){var s,n=this.helper;if(this.arrow)s=0===i&&!this.circle?"addClass":"removeClass",t(this.prevArrow)[s](n.getPartClassName("prev-disable")),s=i===this.capacity-1&&!this.circle?"addClass":"removeClass",t(this.nextArrow)[s](n.getPartClassName("next-disable"));if(this.pager){var a=n.getPartClassName("pager-selected");t(this.pager).find(":eq("+e+")").removeClass(a).end().find(":eq("+i+")").addClass(a)}},dispose:function(){if(this.clearSwitchDelayTimer(),this.isPlaying())this.stop();if(this.curAnim.dispose(),this.curAnim=null,this.arrow)this.undelegate(this.prevArrow,"click",this.onPrevClick),this.undelegate(this.nextArrow,"click",this.onNextClick),this.prevArrow=this.nextArrow=null;if(this.pager)this.undelegate(this.pager,"click",this.onPagerClick),this.pager=null;var t=this.main;this.undelegate(t,"mouseenter",this.onEnter).undelegate(t,"mouseleave",this.onLeave),this.main=this.stage=null,this.$parent()}});return n.Anim=s,n});